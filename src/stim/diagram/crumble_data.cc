#include "stim/diagram/crumble_data.h"

std::string stim_draw_internal::make_crumble_html() {
    std::string result;
    result.append(R"CRUMBLE_PART(<iframe width=100% height=400 srcdoc=")CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;!DOCTYPE html&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;html lang=&quot;en&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;head&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;meta charset=&quot;UTF-8&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;title&gt;Crumble&lt;/title&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;link rel=&quot;shortcut icon&quot; href=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABgWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kTlIA0EUhj+j4kHEwhQiFluolQFREUuNgggRQlTwKtzdnJBdw27ExlKwDVh4NF6FjbW2FraCIHiAWFpZKdpIWN8kgQQxDgzz8c/8j/f+Ad9RxrTchgGw7JwTnQppC4tLWtMrrfiAAC266WbHI5EwNdfXPXXqvAuqWrXf/bnaYnHXhDpNeMzMOjnhVeGRjVxW8Z7qwkzpMeFz4X5HGhR+VLpR4jfFySKrpgk4c9EJ4YCwlqxio4rNlGMJDwv3xCxb6vsWShxTvKnYyqyb5T7VhP64PT+rdNndTDHNDBE0DNZJkyFHUE5bFJeo3Idq+LuK/oi4DHGlMcUxyRoWetGP+oPf2bqJocFSJX8IGl8876MXmnagkPe872PPK5xA/TNc2RX/2hGMfoqer2g9h9C+BRfXFc3Yhctt6HzK6o5elOpl+xIJeD+Tb1qEjltoXS7lVr7n9AHmJKvwDewfQF9Saq/UmLu5Ord/35Tz+wHVp3JoxsjWZAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+YKAhYQLxXIct8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAx0lEQVRYw+2XwQ7EIAhEB+N/E76cnkgIa6OuWTFxvTWxdRgKDwmAYu+i+KDKPP62CJjHNYsQ7Psk8iGk7AxdmeGC1e0CvBBbKQK8ljQB5kK2AxcLsJLMdoBKZvQAULMOtk5IR7Dg294+yw4RymUBs3qQ5bHAO34vC8yFPwvSBFhJ3skC35Bq1sHHsKDGKfUX94J46HllGDjd5XnI5WjOXwXQSg5X95eXaaU3zXSjG3XJ79LW1ak1RsX9/qdsldqsPTppo66k6QGRuElWZ7d4CQAAAABJRU)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(5ErkJggg==&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;/head&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;body style=&quot;margin: 0&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    This is a &lt;strong&gt;prototype&lt;/strong&gt; of crumble, an interactive editor for 2d stabilizer circuit.&lt;br&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    It is still in development. It is not stable or polished.&lt;br&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnShowHideImportExport&quot;&gt;Show Import/Export&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;clear&quot;&gt;Clear&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnClearMarkers&quot;&gt;Clear Pauli Frames&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnUndo&quot;&gt;Undo (ctrl+Z)&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnRedo&quot;&gt;Redo (ctrl+Y)&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnPrevLayer&quot;&gt;Prev Layer (q)&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnNextLayer&quot;&gt;Next Layer (e)&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnRotate45&quot;&gt;Rotate 45 Clockwise ↻ (t)&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;button id=&quot;btnRotate45Counter&quot;&gt;Rotate 45 Mathwise ↺ (shift+t)&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;textarea id=&quot;txtDefaultCircuit&quot; style=&quot;display: none&quot;&gt;[[[DEFAULT_CIRCUIT_CONTENT_LITERAL]]]&lt;/textarea&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;canvas id=&quot;toolbox&quot; style=&quot;width: 500px; height: 120px; border: 1px solid black; margin: 0; padding: 0;&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;/canvas&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;div id=&quot;divImportExport&quot; style=&quot;display: none&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        &lt;div&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            &lt;textarea id=&quot;txtStimCircuit&quot; style=&quot;width: 95vw; height: 300px; background-color: #FFFFB0&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            &lt;/textarea&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        &lt;/div&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        &lt;button id=&quot;btnExport&quot; style=&quot;background-color: red&quot;&gt;↑ Export to Stim Circuit ↑&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        &lt;button id=&quot;btnImport&quot; style=&quot;background-color: red&quot;&gt;↓ Import from Stim Circuit ↓&lt;/button&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;/div&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;canvas id=&quot;cvn&quot; style=&quot;width: 95vw; height: 80vh; border: 1px solid black; margin: 0; padding: 0;&quot; tabindex=&quot;0&quot;&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    &lt;/canvas&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;/body&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;/html&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;script&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(class i{constructor(t,r,e,i,o,a,n,s=void 0){this.name=t,this.t=r,this.i=i,this.o=e,this.l=o,this.h=a,this.v=n,this.u=s}X(t){return new i(this.name,this.t,this.o,this.i,this.l,this.h,this.v,t)}}function E(r){var e=[];for(let t=0;t&lt;r.length;t++){var i=&quot;I&quot;.repeat(t),o=&quot;I&quot;.repeat(r.length-t-1);&quot;X&quot;!==r[t]&amp;&amp;&quot;Y&quot;!==r[t]||e.push(i+&quot;X&quot;+o),&quot;Z&quot;!==r[t]&amp;&amp;&quot;Y&quot;!==r[t]||e.push(i+&quot;Z&quot;+o)}return e}class b{constructor(t,r,e){if(!(t instanceof i))throw new Error(&quot;!(gate instanceof Gate)&quot;);if(!(r instanceof Float32Array))throw new Error(&quot;!(args instanceof Float32Array)&quot;);if(!(e instanceof Uint32Array))throw new Error(&quot;!(targets instanceof Uint32Array)&quot;);this.Z=t,this.Y=r,this.R=e}M(r){let e=this.Z.l;if(void 0===e)return r;if(r.length!==this.Z.t)throw new Error(&quot;before.length !== this.gate.num_qubits&quot;);if(e.has(r))return e.get(r);let t=E(r);var i,o=[0,0];for(i of t=t.map(t=&gt;e.get(t)))for(let t=0;t&lt;r.length;t++)&quot;X&quot;===i[t]&amp;&amp;(o[t]^=1),&quot;Y&quot;===i[t]&amp;&amp;(o[t]^=3),&quot;Z&quot;===i[t]&amp;&amp;(o[t]^=2);let a=&quot;&quot;;for(let t=0;t&lt;r.length;t++)a+=&quot;IXZY&quot;[o[t]];return )CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(a}I(t,r){r.save();try{this.Z.v(this,t,r)}finally{r.restore()}}}const d=50,nt=10;function a(t,r,e){void 0!==r&amp;&amp;void 0!==e&amp;&amp;(t.strokeStyle=&quot;black&quot;,t.fillStyle=&quot;white&quot;,t.beginPath(),t.arc(r,e,nt,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.moveTo(r,e-nt),t.lineTo(r,e+nt),t.stroke(),t.beginPath(),t.moveTo(r-nt,e),t.lineTo(r+nt,e),t.stroke())}function n(t,r,e){void 0!==r&amp;&amp;void 0!==e&amp;&amp;(t.strokeStyle=&quot;black&quot;,t.fillStyle=&quot;#AAA&quot;,t.beginPath(),t.moveTo(r,e+nt),t.lineTo(r+nt,e-nt),t.lineTo(r-nt,e-nt),t.lineTo(r,e+nt),t.stroke(),t.fill())}function s(t,r,e){void 0!==r&amp;&amp;void 0!==e&amp;&amp;(t.fillStyle=&quot;black&quot;,t.beginPath(),t.arc(r,e,nt,0,2*Math.PI),t.fill())}function l(t,r,e){var i;void 0!==r&amp;&amp;void 0!==e&amp;&amp;(t.fillStyle=&quot;#888&quot;,t.strokeStyle=&quot;#222&quot;,t.beginPath(),t.arc(r,e,nt,0,2*Math.PI),t.fill(),t.stroke(),i=.4*nt,t.lineWidth=3,t.strokeStyle=&quot;black&quot;,t.beginPath(),t.moveTo(r-i,e-i),t.lineTo(r+i,e+i),t.stroke(),t.moveTo(r-i,e+i),t.lineTo(r+i,e-i),t.stroke(),t.lineWidth=1)}function C(t,r,e){var i;void 0!==r&amp;&amp;void 0!==e&amp;&amp;(i=nt/3,t.)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(strokeStyle=&quot;black&quot;,t.beginPath(),t.moveTo(r-i,e-i),t.lineTo(r+i,e+i),t.stroke(),t.moveTo(r-i,e+i),t.lineTo(r+i,e-i),t.stroke())}function _(t,r,e){var i;void 0!==r&amp;&amp;void 0!==e&amp;&amp;(i=1.1*nt,t.strokeRect(r-i,e-i,2*i,2*i))}function st(t,r,e,i,o){var a,n,s,l,h;void 0===r||void 0===e||void 0===i||void 0===o?(_(t,r,e),_(t,i,o)):i&lt;r||i===r&amp;&amp;o&lt;e?st(t,i,o,r,e):(n=i-r,l=s=(a=o-e)/(a=Math.sqrt(n*n+a*a))*14,h=-(n=n/a*14),t.beginPath(),t.moveTo(r,e),a&lt;1.1*d?t.lineTo(i,o):t.bezierCurveTo(r+n+l,e+s+h,i-n+l,o-s+h,i,o),t.stroke())}function h(t,r,e,i,o){t.lineWidth=2,t.strokeStyle=&quot;black&quot;,st(t,r,e,i,o),t.lineWidth=1}function*g(){yield new i(&quot;CXSWAP&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;XI&quot;],[&quot;IZ&quot;,&quot;ZZ&quot;],[&quot;XI&quot;,&quot;XX&quot;],[&quot;ZI&quot;,&quot;IZ&quot;]]),(t,r)=&gt;t.do_cx_swap(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t),o=e,n=n,void 0!==(a=a)&amp;&amp;void 0!==n&amp;&amp;(o.fillStyle=&quot;black&quot;,o.strokeStyle=&quot;black&quot;,o.beginPath(),o.arc(a,n,nt,0,2*Math.PI),o.fill(),o.stroke(),i=.4*nt,o.strokeStyle=&quot;white&quot;,o.lineWidth=3,o.beginPath(),o.moveTo(a-i,n-i),o.lineTo(a+i,n+i),)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(o.stroke(),o.moveTo(a-i,n+i),o.lineTo(a+i,n-i),o.stroke(),o.lineWidth=1),a=e,n=t,void 0!==(i=r)&amp;&amp;void 0!==n&amp;&amp;(a.fillStyle=&quot;white&quot;,a.strokeStyle=&quot;black&quot;,a.beginPath(),a.arc(i,n,nt,0,2*Math.PI),a.fill(),a.stroke(),o=.4*nt,a.strokeStyle=&quot;black&quot;,a.lineWidth=3,a.beginPath(),a.moveTo(i-o,n-o),a.lineTo(i+o,n+o),a.stroke(),a.moveTo(i-o,n+o),a.lineTo(i+o,n-o),a.stroke(),a.lineWidth=1)}),yield new i(&quot;CX&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;IX&quot;],[&quot;IZ&quot;,&quot;ZZ&quot;],[&quot;XI&quot;,&quot;XX&quot;],[&quot;ZI&quot;,&quot;ZI&quot;]]),(t,r)=&gt;t.do_cx(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),s(e,i,o),a(e,r,t)}),yield new i(&quot;CY&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;ZX&quot;],[&quot;IZ&quot;,&quot;ZZ&quot;],[&quot;XI&quot;,&quot;XY&quot;],[&quot;ZI&quot;,&quot;ZI&quot;]]),(t,r)=&gt;t.do_cy(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),s(e,i,o),n(e,r,t)}),yield new i(&quot;XCX&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;IX&quot;],[&quot;IZ&quot;,&quot;XZ&quot;],[&quot;XI&quot;,&quot;XI&quot;],[&quot;ZI&quot;,&quot;ZX&quot;]]),(t,r)=&gt;t.do_xcx(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),a(e,i,o),a(e,r,t)}),yield new i(&quot;XCY&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;XX&quot;],[&quot;IZ&quot;,&quot;XZ&quot;],[&quot;XI&quot;,&quot;XI&quot;],[&quot;ZI&quot;,&quot;ZY&quot;]]),(t,r)=&gt;t.do_xcy()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),a(e,i,o),n(e,r,t)}),yield new i(&quot;YCY&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;YX&quot;],[&quot;IZ&quot;,&quot;YZ&quot;],[&quot;XI&quot;,&quot;XY&quot;],[&quot;ZI&quot;,&quot;ZY&quot;]]),(t,r)=&gt;t.do_ycy(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),n(e,i,o),n(e,r,t)}),yield new i(&quot;CZ&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;ZX&quot;],[&quot;IZ&quot;,&quot;IZ&quot;],[&quot;XI&quot;,&quot;XZ&quot;],[&quot;ZI&quot;,&quot;ZI&quot;]]),(t,r)=&gt;t.do_cz(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),s(e,i,o),s(e,r,t)})}function W(e,i){if(e.beginPath(),0!==i.length){var r=i.length;if(1===r){var[[o,a]]=i;e.arc(o,a,1.7*nt,0,2*Math.PI)}else if(2===r){var[[o,a],[n,s]]=i,l=n-o,h=s-a,f=(n+o)/2,c=(s+a)/2;let t=-h,r=l;var v=t*t+r*r,v=(2500&lt;v&amp;&amp;(v=50/Math.sqrt(v),t*=v,r*=v),f+.2*t-.2*l),d=c+.2*r-.2*h,w=f+.2*t+.2*l,u=c+.2*r+.2*h,X=f-.2*t-.2*l,Z=c-.2*r-.2*h,f=f-.2*t+.2*l,l=c-.2*r+.2*h;e.moveTo(o,a),e.bezierCurveTo(v,d,w,u,n,s),e.bezierCurveTo(f,l,X,Z,o,a)}else{var[c,h]=i[r-1];e.moveTo(c,h);for(let t=0;t&lt;r;t++){var[Y,R]=i[t];e.lineTo(Y,R)}}}}function U(t){let r,e,i,o;return o=0===t?(r=nt,e=nt+5,i=2*nt,5)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART():1===t?(r=-nt,e=nt,i=5,2*nt):2===t?(r=nt,e=-nt,i=2*nt,5):3===t?(r=nt+5,e=nt,i=5,2*nt):(r=Math.cos(t/5)*nt,e=Math.sin(t/5)*nt,i=5),{dx:r,dy:e,m:i,p:o}}function*S(){yield*g(),yield new i(&quot;MR&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:I&quot;],[&quot;Y&quot;,&quot;ERR:I&quot;],[&quot;Z&quot;,&quot;I&quot;]]),(t,r)=&gt;t.do_demolition_measure(&quot;Z&quot;,r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MR&quot;,r,t)}),yield new i(&quot;MRY&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:I&quot;],[&quot;Y&quot;,&quot;I&quot;],[&quot;Z&quot;,&quot;ERR:I&quot;]]),(t,r)=&gt;t.do_demolition_measure(&quot;Y&quot;,r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MRY&quot;,r,t)}),yield new i(&quot;MRX&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;I&quot;],[&quot;Y&quot;,&quot;ERR:I&quot;],[&quot;Z&quot;,&quot;ERR:I&quot;]]),(t,r)=&gt;t.do_demolition_measure(&quot;X&quot;,r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MRX&quot;,r,t)}),yield new i(&quot;H&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Z&quot;],[&quot;Z&quot;,&quot;X&quot;]]),(t,r)=&gt;t.do_exchange_xz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;H&quot;,r,t)}),yield new i(&quot;H_XY&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Y&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),(t,r)=&gt;t.do_exchange_xy(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;H&quot;,r,t-nt/3),e.fillText(&quot;XY&quot;,r,t+nt/3)}),yield new i(&quot;H_YZ&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Y&quot;]]),(t,r)=&gt;t.do_exchange_yz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;H&quot;,r,t-nt/3),e.fillText(&quot;YZ&quot;,r,t+nt/3)}),yield new i(&quot;POLYGON&quot;,void 0,!1,!0,void 0,()=&gt;{},(t,r,e)=&gt;{var i,o=[];for(i of t.R)o.push(r(i));W(e,o),e.globalAlpha*=t.Y[3],e.fillStyle=`rgb(${255*t.Y[0]},${255*t.Y[1]},${255*t.Y[2]})`,e.strokeStyle=`rgb(${32*t.Y[0]},${32*t.Y[1]},${32*t.Y[2]})`,e.fill(),e.stroke()}),yield new i(&quot;MARKX&quot;,1,!0,!0,void 0,()=&gt;{},(o,a,n)=&gt;{var[a,s]=a(o.R[0]);if(void 0!==a&amp;&amp;void 0!==s){var{dx:o,dy:l,m:h,p:f}=U(o.Y[0]);let t,r,e,i;i=h===f?(t=a+o,r=s+l,e=t+o+h,r+l+f):(t=a+(o&lt;0?1:-1)*nt,r=s+(l&lt;0?1:-1)*nt,e=t+(h&gt;nt?1:0)*nt*2,r+(f&gt;nt?1:0)*nt*2),n.fillStyle=&quot;red&quot;,n.beginPath(),n.moveTo(a,s),n.lineTo(t,r),n.lineTo(e,i),n.lineTo(a,s),n.fill()}}),yield new i(&quot;MARKY&quot;,1,!0,!0,void 0,()=&gt;{},(o,a,n)=&gt;{var[a,s]=a(o.R[0]);if(void 0!==a&amp;&amp;void 0!==s){var{dx:o,dy:l,m:h,p:f}=U(o.Y[0]);let t,r,e,i;i=h===f?(t=a+o,r=s+l,e=t+o+h,r+l+f):(t=a+(o&lt;0?1:-1)*nt,r=s+(l&lt;0?1:-1)*nt,e=t+(h&gt;nt?1:0)*nt*2,r+(f&gt;nt?1:0)*nt*2),n.fillStyle=&quot;green&quot;)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,n.beginPath(),n.moveTo(a,s),n.lineTo(t,r),n.lineTo(e,i),n.lineTo(a,s),n.fill()}}),yield new i(&quot;MARKZ&quot;,1,!0,!0,void 0,()=&gt;{},(o,a,n)=&gt;{var[a,s]=a(o.R[0]);if(void 0!==a&amp;&amp;void 0!==s){var{dx:o,dy:l,m:h,p:f}=U(o.Y[0]);let t,r,e,i;i=h===f?(t=a+o,r=s+l,e=t+o+h,r+l+f):(t=a+(o&lt;0?1:-1)*nt,r=s+(l&lt;0?1:-1)*nt,e=t+(h&gt;nt?1:0)*nt*2,r+(f&gt;nt?1:0)*nt*2),n.fillStyle=&quot;blue&quot;,n.beginPath(),n.moveTo(a,s),n.lineTo(t,r),n.lineTo(e,i),n.lineTo(a,s),n.fill()}}),yield new i(&quot;MARK&quot;,1,!1,!0,void 0,()=&gt;{},(t,r,e)=&gt;{var[r,t]=r(t.R[0]);void 0!==r&amp;&amp;void 0!==t&amp;&amp;(e.fillStyle=&quot;magenta&quot;,e.fillRect(r-nt,t-nt,nt,nt))}),yield new i(&quot;MXX&quot;,2,!0,!1,new Map([[&quot;II&quot;,&quot;II&quot;],[&quot;IX&quot;,&quot;IX&quot;],[&quot;IY&quot;,&quot;ERR:IY&quot;],[&quot;IZ&quot;,&quot;ERR:IZ&quot;],[&quot;XI&quot;,&quot;XI&quot;],[&quot;XX&quot;,&quot;XX&quot;],[&quot;XY&quot;,&quot;ERR:XY&quot;],[&quot;XZ&quot;,&quot;ERR:XZ&quot;],[&quot;YI&quot;,&quot;ERR:YI&quot;],[&quot;YX&quot;,&quot;ERR:YX&quot;],[&quot;YY&quot;,&quot;YY&quot;],[&quot;YZ&quot;,&quot;YZ&quot;],[&quot;ZI&quot;,&quot;ERR:ZI&quot;],[&quot;ZX&quot;,&quot;ERR:ZX&quot;],[&quot;ZY&quot;,&quot;ZY&quot;],[&quot;ZZ&quot;,&quot;ZZ&quot;]]),(t,r)=&gt;t.do_measure(&quot;XX&quot;,r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),e.fillStyle=&quot;gray&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strok)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(eStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MXX&quot;,i,o),e.fillText(&quot;MXX&quot;,r,t)}),yield new i(&quot;MYY&quot;,2,!0,!1,new Map([[&quot;II&quot;,&quot;II&quot;],[&quot;IX&quot;,&quot;ERR:IX&quot;],[&quot;IY&quot;,&quot;IY&quot;],[&quot;IZ&quot;,&quot;ERR:IZ&quot;],[&quot;XI&quot;,&quot;ERR:XI&quot;],[&quot;XX&quot;,&quot;XX&quot;],[&quot;XY&quot;,&quot;ERR:XY&quot;],[&quot;XZ&quot;,&quot;XZ&quot;],[&quot;YI&quot;,&quot;YI&quot;],[&quot;YX&quot;,&quot;ERR:YX&quot;],[&quot;YY&quot;,&quot;YY&quot;],[&quot;YZ&quot;,&quot;ERR:YZ&quot;],[&quot;ZI&quot;,&quot;ERR:ZI&quot;],[&quot;ZX&quot;,&quot;ZX&quot;],[&quot;ZY&quot;,&quot;ERR:ZY&quot;],[&quot;ZZ&quot;,&quot;ZZ&quot;]]),(t,r)=&gt;t.do_measure(&quot;YY&quot;,r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),e.fillStyle=&quot;gray&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MYY&quot;,i,o),e.fillText(&quot;MYY&quot;,r,t)}),yield new i(&quot;MZZ&quot;,2,!0,!1,new Map([[&quot;II&quot;,&quot;II&quot;],[&quot;IX&quot;,&quot;ERR:IX&quot;],[&quot;IY&quot;,&quot;ERR:IY&quot;],[&quot;IZ&quot;,&quot;IZ&quot;],[&quot;XI&quot;,&quot;ERR:XI&quot;],[&quot;XX&quot;,&quot;XX&quot;],[&quot;XY&quot;,&quot;XY&quot;],[&quot;XZ&quot;,&quot;ERR:XZ&quot;],[&quot;YI&quot;,&quot;ERR:YI&quot;],[&quot;YX&quot;,&quot;YX&quot;],[&quot;YY&quot;,&quot;YY&quot;],[&quot;YZ&quot;,&quot;ERR:Y)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(Z&quot;],[&quot;ZI&quot;,&quot;ZI&quot;],[&quot;ZX&quot;,&quot;ERR:ZX&quot;],[&quot;ZY&quot;,&quot;ERR:ZY&quot;],[&quot;ZZ&quot;,&quot;ZZ&quot;]]),(t,r)=&gt;t.do_measure(&quot;ZZ&quot;,r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),e.fillStyle=&quot;gray&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MZZ&quot;,i,o),e.fillText(&quot;MZZ&quot;,r,t)}),yield new i(&quot;I&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),()=&gt;{},(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;white&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;I&quot;,r,t)}),yield new i(&quot;X&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),()=&gt;{},(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;white&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;X&quot;,r,t)}),yield new i(&quot;Y&quot;,1,!0)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),()=&gt;{},(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;white&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;Y&quot;,r,t)}),yield new i(&quot;Z&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),()=&gt;{},(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;white&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;Z&quot;,r,t)}),yield new i(&quot;S&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Y&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),(t,r)=&gt;t.do_exchange_xy(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;S&quot;,r,t)}),yield new i(&quot;S_DAG&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Y&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),(t,r)=&gt;t.do_exchange_xy(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*n)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(t),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;S†&quot;,r,t)}),yield new i(&quot;SQRT_X&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Y&quot;]]),(t,r)=&gt;t.do_exchange_yz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√X&quot;,r,t)}),yield new i(&quot;SQRT_X_DAG&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Z&quot;,&quot;Y&quot;]]),(t,r)=&gt;t.do_exchange_yz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√X†&quot;,r,t)}),yield new i(&quot;SQRT_Y&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Z&quot;],[&quot;Z&quot;,&quot;X&quot;]]),(t,r)=&gt;t.do_exchange_xz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√Y&quot;,r,t)}),yield new i(&quot;SQRT_Y_DAG&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Z&quot;],[&quot;Z&quot;,&quot;X&quot;]]),(t,r)=&gt;t.do_exchange_xz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;yellow&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√Y†&quot;,r,t)}),yield new i(&quot;R&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:I&quot;],[&quot;Y&quot;,&quot;ERR:I&quot;],[&quot;Z&quot;,&quot;ERR:I&quot;]]),(t,r)=&gt;t.do_discard(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;R&quot;,r,t)}),yield new i(&quot;RX&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:I&quot;],[&quot;Y&quot;,&quot;ERR:I&quot;],[&quot;Z&quot;,&quot;ERR:I&quot;]]),(t,r)=&gt;t.do_discard(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;RX)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&quot;,r,t)}),yield new i(&quot;RY&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:I&quot;],[&quot;Y&quot;,&quot;ERR:I&quot;],[&quot;Z&quot;,&quot;ERR:I&quot;]]),(t,r)=&gt;t.do_discard(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;RY&quot;,r,t)}),yield new i(&quot;M&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:X&quot;],[&quot;Y&quot;,&quot;ERR:Y&quot;],[&quot;Z&quot;,&quot;Z&quot;]]),(t,r)=&gt;t.do_measure(&quot;Z&quot;,r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;M&quot;,r,t),e.textAlign=&quot;left&quot;}),yield new i(&quot;MX&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;X&quot;],[&quot;Y&quot;,&quot;ERR:Y&quot;],[&quot;Z&quot;,&quot;ERR:Z&quot;]]),(t,r)=&gt;t.do_measure(&quot;X&quot;,r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MX&quot;,r,t),e.textAlign=&quot;left&quot;}),yiel)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(d new i(&quot;MY&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;ERR:X&quot;],[&quot;Y&quot;,&quot;Y&quot;],[&quot;Z&quot;,&quot;ERR:Z&quot;]]),(t,r)=&gt;t.do_measure(&quot;Y&quot;,r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;gray&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;MY&quot;,r,t),e.textAlign=&quot;left&quot;}),yield new i(&quot;SQRT_XX&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;IX&quot;],[&quot;IZ&quot;,&quot;XY&quot;],[&quot;XI&quot;,&quot;XI&quot;],[&quot;ZI&quot;,&quot;YX&quot;]]),(t,r)=&gt;t.do_sqrt_xx(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle=&quot;yellow&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√XX&quot;,i,o)}),yield new i(&quot;SQRT_XX_DAG&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;IX&quot;],[&quot;IZ&quot;,&quot;XY&quot;],[&quot;XI&quot;,&quot;XI&quot;],[&quot;ZI&quot;,&quot;YX&quot;]]),(t,r)=&gt;t.do_sqrt_xx(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle=&quot;yellow&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strok)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(eRect(i-nt,o-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√XX†&quot;,i,o)}),yield new i(&quot;SQRT_YY&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;YZ&quot;],[&quot;IZ&quot;,&quot;YX&quot;],[&quot;XI&quot;,&quot;ZY&quot;],[&quot;ZI&quot;,&quot;XY&quot;]]),(t,r)=&gt;t.do_sqrt_yy(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle=&quot;yellow&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√YY&quot;,i,o)}),yield new i(&quot;SQRT_YY_DAG&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;YZ&quot;],[&quot;IZ&quot;,&quot;YX&quot;],[&quot;XI&quot;,&quot;ZY&quot;],[&quot;ZI&quot;,&quot;XY&quot;]]),(t,r)=&gt;t.do_sqrt_yy(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle=&quot;yellow&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√YY†&quot;,i,o)}),yield new i(&quot;SQRT_ZZ&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;ZY&quot;],[&quot;IZ&quot;,&quot;IZ&quot;],[&quot;XI&quot;,&quot;YZ&quot;],[&quot;ZI&quot;,&quot;ZI&quot;]]),(t,r)=&gt;t.do_sqrt_)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(zz(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle=&quot;yellow&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√ZZ&quot;,i,o)}),yield new i(&quot;SQRT_ZZ_DAG&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;ZY&quot;],[&quot;IZ&quot;,&quot;IZ&quot;],[&quot;XI&quot;,&quot;YZ&quot;],[&quot;ZI&quot;,&quot;ZI&quot;]]),(t,r)=&gt;t.do_sqrt_zz(r),(t,r,e)=&gt;{var i,o,[a,n]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle=&quot;yellow&quot;,e.fillRect(i-nt,o-nt,2*nt,2*nt),e.strokeStyle=&quot;black&quot;,e.strokeRect(i-nt,o-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;√ZZ†&quot;,i,o)}),yield new i(&quot;ISWAP&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;YZ&quot;],[&quot;IZ&quot;,&quot;ZI&quot;],[&quot;XI&quot;,&quot;ZY&quot;],[&quot;ZI&quot;,&quot;IZ&quot;]]),(t,r)=&gt;t.do_iswap(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),l(e,i,o),l(e,r,t)}),yield new i(&quot;ISWAP_DAG&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;YZ&quot;],[&quot;IZ&quot;,&quot;ZI&quot;],[&quot;XI&quot;,&quot;ZY&quot;],[&quot;ZI&quot;,&quot;IZ&quot;]]),(t,r)=&gt;t.do_iswap(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,t]=r(t.R[1]);h(e,i,o,r,t),l(e,i,o),l(e,r,t)}),yield new i(&quot;SWAP&quot;,2,!0,!1,new Map([[&quot;IX&quot;,&quot;XI&quot;],[&quot;IZ&quot;,&quot;ZI&quot;],[&quot;XI&quot;,&quot;IX&quot;],[&quot;ZI&quot;,&quot;IZ&quot;]]),(t,r)=&gt;t.do_swap(r),(t,r,e)=&gt;{var[i,o]=r(t.R[0]),[r,t]=r(t.R[1]);h(e,i,o,r,t),C(e,i,o),C(e,r,t)}),yield new i(&quot;C_XYZ&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Y&quot;],[&quot;Z&quot;,&quot;X&quot;]]),(t,r)=&gt;t.do_cycle_xyz(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;teal&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;C&quot;,r,t-nt/3),e.fillText(&quot;XYZ&quot;,r,t+nt/3)}),yield new i(&quot;C_ZYX&quot;,1,!0,!1,new Map([[&quot;X&quot;,&quot;Z&quot;],[&quot;Z&quot;,&quot;Y&quot;]]),(t,r)=&gt;t.do_cycle_zyx(r),(t,r,e)=&gt;{var[r,t]=r(t.R[0]);e.fillStyle=&quot;teal&quot;,e.fillRect(r-nt,t-nt,2*nt,2*nt),e.fillStyle=&quot;black&quot;,e.strokeStyle=&quot;black&quot;,e.strokeRect(r-nt,t-nt,2*nt,2*nt),e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;C&quot;,r,t-nt/3),e.fillText(&quot;ZYX&quot;,r,t+nt/3)})}const k=function(){var t,r=new Map;for(t of S())r.set(t.name,t);return r}();class A{constructor(){this.k=new Map,th)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(is.A=[]}C(){var t=new A;return t.k=new Map(this.k),t.A=[...this.A],t}empty(){return 0===this.k.size&amp;&amp;0===this.A.length}_(t){var r,e,i=new A;for(r of this.k.values())t(r)&amp;&amp;i.put(r);for(e of this.A)t(e)&amp;&amp;i.A.push(e);return i}g(r){return this._(t=&gt;!t.R.every(t=&gt;!r(t)))}S(e,t){var r,i,o=new Map,a=new Set;for(r of e.keys()){var n=e.get(r),s=this.k.get(r);if(void 0!==s){let r=&quot;&quot;;for(var l of s.R){a.has(l),a.add(l);let t=e.get(l);void 0===t&amp;&amp;(t=&quot;I&quot;),r+=t}var h=s.M(r),f=h.startsWith(&quot;ERR:&quot;);for(let t=0;t&lt;s.R.length;t++){var c=s.R[t];f?o.set(c,&quot;ERR:&quot;+h[4+t]):o.set(c,h[t])}}else o.set(r,n)}for(i of this.A)if(&quot;MARKX&quot;===i.Z.name&amp;&amp;i.Y[0]===t){var v=i.R[0];let t=o.get(v);void 0===t||&quot;I&quot;===t?t=&quot;X&quot;:&quot;X&quot;===t?t=&quot;I&quot;:&quot;Y&quot;===t?t=&quot;Z&quot;:&quot;Z&quot;===t&amp;&amp;(t=&quot;Y&quot;),o.set(v,t)}else if(&quot;MARKY&quot;===i.Z.name&amp;&amp;i.Y[0]===t){v=i.R[0];let t=o.get(v);void 0===t||&quot;I&quot;===t?t=&quot;Y&quot;:&quot;X&quot;===t?t=&quot;Z&quot;:&quot;Y&quot;===t?t=&quot;I&quot;:&quot;Z&quot;===t&amp;&amp;(t=&quot;X&quot;),o.set(v,t)}else if(&quot;MARKZ&quot;===i.Z.name&amp;&amp;i.Y[0]===t){var d=i.R[0];let t=o.get(d);void 0===t||&quot;I&quot;===t?t=&quot;Z&quot;:&quot;X&quot;===t?t=&quot;Y&quot;:&quot;Y&quot;===t?t=&quot;X&quot;:&quot;Z&quot;===t&amp;)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&amp;(t=&quot;I&quot;),o.set(d,t)}return o}O(){return 0===this.k.size&amp;&amp;0===this.A.length}T(r){if(this.A=this.A.filter(t=&gt;-1===t.R.indexOf(r)),this.k.has(r)){var t,e=this.k.get(r);for(t of e.R)this.k.delete(t);return e}}K(r,e=void 0){this.A=this.A.filter(t=&gt;void 0!==e&amp;&amp;t.Y[0]!==e||&quot;MARKX&quot;!==t.Z.name&amp;&amp;&quot;MARKY&quot;!==t.Z.name&amp;&amp;&quot;MARKZ&quot;!==t.Z.name||t.R[0]!==r)}put(t,r=!0){if(t.Z.i)&quot;MARKX&quot;!==t.Z.name&amp;&amp;&quot;MARKY&quot;!==t.Z.name&amp;&amp;&quot;MARKZ&quot;!==t.Z.name||this.K(t.R[0],t.Y[0]),this.A.push(t);else{for(var e of t.R)if(this.k.has(e)){if(!r)throw new Error(&quot;Collision&quot;);this.T(e)}for(var i of t.R)this.k.set(i,t)}}*P(){for(var t of this.k.keys()){var r=this.k.get(t);r.R[0]===t&amp;&amp;(yield r)}yield*this.A}}function Y(t){let r=void 0,e=void 0;for(var[i,o]of t)(void 0===r||i&lt;r||i===r&amp;&amp;o&lt;e)&amp;&amp;(r=i,e=o);return[r,e]}function O(t,r){var e,i=new Map;for(e of t){var o=r(e),a=i.get(o);void 0===a?i.set(o,[e]):a.push(e)}return i}class u{constructor(t,r=[]){if(!(t instanceof Float64Array))throw new Error(&quot;!(qubitCoords instanceof Float64Array)&quot;);if(!Array.isArray(r))throw)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART( new Error(&quot;!Array.isArray(layers)&quot;);if(!r.every(t=&gt;t instanceof A))throw new Error(&quot;!layers.every(e =&gt; e instanceof Layer)&quot;);this.L=t,this.G=r}static D(t){t=t.replaceAll(&quot;;&quot;,&quot;\n&quot;).replaceAll(&quot;_&quot;,&quot; &quot;).replaceAll(&quot;Q(&quot;,&quot;QUBIT_COORDS(&quot;).replaceAll(&quot;DT&quot;,&quot;DETECTOR&quot;).replaceAll(&quot; COORDS&quot;,&quot;_COORDS&quot;).replaceAll(&quot; ERROR&quot;,&quot;_ERROR&quot;).replaceAll(&quot;C XYZ&quot;,&quot;C_XYZ&quot;).replaceAll(&quot;H XY&quot;,&quot;H_XY&quot;).replaceAll(&quot;H YZ&quot;,&quot;H_YZ&quot;).replaceAll(&quot; INCLUDE&quot;,&quot;_INCLUDE&quot;).replaceAll(&quot;SQRT &quot;,&quot;SQRT_&quot;).replaceAll(&quot; DAG &quot;,&quot;_DAG &quot;).replaceAll(&quot;C ZYX&quot;,&quot;C_ZYX&quot;).split(&quot;\n&quot;);let M=[new A],I=new Map,m=new Set,e=0,p=t=&gt;{for(;!I.has(t);){var r=e+&quot;,0&quot;;m.has(r)||(m.add(r),I.set(t,[e,0])),e++}},s=(e,i,o,r)=&gt;{M[M.length-1].empty()||M.push(new A);for(let t=0;t&lt;r;t++){for(let r=i;r&lt;o;r++){let t=e[r];var a,n;(t=t.split(&quot;#&quot;)[0].trim()).toLowerCase().startsWith(&quot;repeat &quot;)?(a=parseInt(t.split(&quot; &quot;)[1]),n=((e,t,i)=&gt;{let o=0;for(let r=t;r&lt;i;r++){let t=e[r];if((t=t.split(&quot;#&quot;)[0].trim()).toLowerCase().startsWith(&quot;repeat &quot;))o++;else if(&quot;}&quot;===t&amp;&amp;0===--o)return r}throw Error(&quot;)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(Repeat block didn&#x27;t end&quot;)})(e,r,o),s(e,r+1,n,a),r=n):(o=&gt;{let a=[],n=[],s=&quot;&quot;;if(o.indexOf(&quot;)&quot;)!==-1){let[t,r]=o.split(&quot;)&quot;);let[e,i]=t.split(&quot;(&quot;);s=e.trim();a=i.split(&quot;,&quot;).map(t=&gt;t.trim()).map(parseFloat);n=r.split(&quot; &quot;).map(t=&gt;t.trim()).filter(t=&gt;t!==&quot;&quot;)}else{let t=o.split(&quot; &quot;).map(t=&gt;t.trim()).filter(t=&gt;t!==&quot;&quot;);if(t.length===0)return;let[r,...e]=t;s=r.trim();a=[];n=e.map(t=&gt;t.trim()).filter(t=&gt;t!==&quot;&quot;)}let e=false;if(&quot;&quot;!==s){if(&quot;XCZ&quot;===s)e=!0,s=&quot;CX&quot;;else if(&quot;SWAPCX&quot;===s)e=!0,s=&quot;CXSWAP&quot;;else if(&quot;CNOT&quot;===s)s=&quot;CX&quot;;else if(&quot;RZ&quot;===s)s=&quot;R&quot;;else if(&quot;MZ&quot;===s)s=&quot;M&quot;;else if(&quot;MRZ&quot;===s)s=&quot;MR&quot;;else if(&quot;ZCX&quot;===s)s=&quot;CX&quot;;else if(&quot;ZCY&quot;===s)s=&quot;CY&quot;;else if(&quot;ZCZ&quot;===s)s=&quot;CZ&quot;;else if(&quot;YCX&quot;===s)e=!0,s=&quot;XCY&quot;;else if(&quot;YCZ&quot;===s)e=!0,s=&quot;CY&quot;;else{if(&quot;TICK&quot;===s)return M.push(new A);if(&quot;MPP&quot;===s){M[M.length-1];for(var r of n){let e=&quot;M&quot;;var l=[],h;for(h of r.split(&quot;*&quot;))e+=h[0],l.push(h.substring(1));let i=k.get(e);var f=new Float32Array(a),c=M[M.length-1];if(void 0!==i)c.put(new b(i,f,new Uint32Array(l)));else{console.warn(&quot;SPLIT MPP INTO I)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(NDIVIDUAL MEASUREMENTS&quot;);for(let r=0;r&lt;e.length-1;r++){let t=&quot;M&quot;+e[r+1];&quot;MZ&quot;===t&amp;&amp;(t=&quot;M&quot;),i=k.get(t),c.put(new b(i,f,new Uint32Array(l[r])))}}}return}if(&quot;X_ERROR&quot;===s||&quot;Y_ERROR&quot;===s||&quot;Z_ERROR&quot;===s||&quot;DETECTOR&quot;===s||&quot;OBSERVABLE_INCLUDE&quot;===s||&quot;DEPOLARIZE1&quot;===s||&quot;DEPOLARIZE2&quot;===s||&quot;SHIFT_COORDS&quot;===s||&quot;REPEAT&quot;===s||&quot;}&quot;===s)return;if(s.startsWith(&quot;QUBIT_COORDS&quot;)){var i=a.length&lt;1?0:a[0],v=a.length&lt;2?0:a[1],d;for(d of n){var w=parseInt(d);I.has(w)?console.warn(`Ignoring &quot;${o}&quot; because there&#x27;s already coordinate data for qubit ${w}.`):m.has(i+&quot;,&quot;+v)?console.warn(`Ignoring &quot;${o}&quot; because there&#x27;s already a qubit placed at ${i},${v}.`):(I.set(w,[i,v]),m.add(i+&quot;,&quot;+v))}return}}let t=!1;for(var u of n){if(u.startsWith(&quot;rec[&quot;)&amp;&amp;(&quot;CX&quot;===s||&quot;CY&quot;===s||&quot;CZ&quot;===s||&quot;ZCX&quot;===s||&quot;ZCY&quot;===s)){t=!0;break}var X=parseInt(u);if(&quot;number&quot;!=typeof parseInt(u))throw new Error(o);p(X)}if(t)console.warn(&quot;IGNORED&quot;,s);else{var Z=k.get(s);if(void 0===Z)throw new Error(&quot;Unrecognized gate name in &quot;+o);var Y=new Float32Array(a);let r=M[M.length-1];if()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(void 0===Z.t)r.put(new b(Z,Y,new Uint32Array(n)));else{if(n.length%Z.t!=0)throw new Error(&quot;Incorrect number of targets in line &quot;+o);for(let t=0;t&lt;n.length;t+=Z.t){var R=n.slice(t,t+Z.t),y=(e&amp;&amp;R.reverse(),new Uint32Array(R));try{r.put(new b(Z,Y,y),!1)}catch(t){M.push(new A),(r=M[M.length-1]).put(new b(Z,Y,y),!1)}}}}}})(t)}M[M.length-1].empty()||M.push(new A)}};s(t,0,t.length,1),0&lt;M.length&amp;&amp;M[M.length-1].O()&amp;&amp;M.pop();var r=Math.max(...I.keys(),0)+1,i=new Float64Array(2*r);for(let t=0;t&lt;r;t++){p(t);var[o,a]=I.get(t);i[2*t]=o,i[2*t+1]=a}return new u(i,M)}F(){var t,r=new Set;for(t of this.G)for(var e of t.P())for(var i of e.R)r.add(i);return r}N(){return this.U((t,r)=&gt;[t-r,t+r])}H(){var t,r,e=new Map;for(let t=0;t&lt;this.L.length;t+=2){var i=this.L[t],o=this.L[t+1];e.set(i+&quot;,&quot;+o,[i,o])}let a=1/0,n=1/0,s=256;for([t,r]of e.values())for(a=Math.min(t,a),n=Math.min(r,n);(t%s!=0||r%s!=0)&amp;&amp;s&gt;1/256;)s/=2;let l;if(s&lt;=1/256)l=1;else{l=1/s;let t=0;for(var[h,f]of e.values()){var c=(h-a+f-n)%(2*s),h=(h-a-f+n)%(2*s);t=t|(0==c?1:2)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART()|(0==h?4:8)}5===t?l/=2:10===t&amp;&amp;(a-=s,l/=2)}let v=-a,d=-n;return(t,r)=&gt;[(t+v)*l,(r+d)*l]}$(){return this.U(this.H())}q(e,i){return this.U((t,r)=&gt;[t+e,r+i])}C(){return this.q(0,0)}U(r){var e=new Float64Array(this.L.length);for(let t=0;t&lt;this.L.length;t+=2){var[i,o]=r(this.L[t],this.L[t+1]);e[t]=i,e[t+1]=o}var t=this.G.map(t=&gt;t.C());return new u(e,t)}W(){var t,r=new Set;for(t of this.G)for(var e of t.P())for(var i of e.R)r.add(i);var o,a=[];for(o of r){var n=this.L[2*o],s=this.L[2*o+1];a.push({B:o,x:n,y:s})}a.sort((t,r)=&gt;t.x!==r.x?t.x-r.x:t.y!==r.y?t.y-r.y:t.B-r.B);var l,h=new Map,f=[];for(let t=0;t&lt;a.length;t++){var{B:c,x:v,y:d}=a[t];h.set(c,t),f.push(`QUBIT_COORDS(${v}, ${d}) `+t)}for(l of this.G){var w,u=O(l.P(),t=&gt;{let r=t.Z.name;return 0&lt;t.Y.length&amp;&amp;(r+=&quot;(&quot;+[...t.Y].join(&quot;,&quot;)+&quot;)&quot;),r}),X=[...u.keys()];X.sort((t,r)=&gt;{var e=t.startsWith(&quot;MARK&quot;)||t.startsWith(&quot;POLY&quot;),i=r.startsWith(&quot;MARK&quot;)||r.startsWith(&quot;POLY&quot;);return e!==i?e&lt;i?-1:1:t&lt;r?-1:r&lt;t?1:0});for(w of X){var Z,Y=u.get(w),R=[];if(k.get(w.split(&quot;(&quot;)[0]).o)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(){var y,M=[];for(y of Y)M.push(...y.R);R.push(M)}else for(var I of Y)R.push([...I.R]);for(Z of R){var m,p=[w];for(m of Z)p.push(h.get(m));f.push(p.join(&quot; &quot;))}}f.push(&quot;TICK&quot;)}for(;0&lt;f.length&amp;&amp;&quot;TICK&quot;===f[f.length-1];)f.pop();return f.join(&quot;\n&quot;)}V(t){var r,e,i=this.j(),o=[];for([r,e]of t){var a=r+&quot;,&quot;+e;i.has(a)||(i.set(a,i.size),o.push(r,e))}return new u(new Float64Array([...this.L,...o]),this.G.map(t=&gt;t.C()))}j(){var r=new Map;for(let t=0;t&lt;this.L.length;t+=2){var e=this.L[t],i=this.L[t+1];r.set(e+&quot;,&quot;+i,t/2)}return r}toString(){return this.W()}J(t){return t instanceof u&amp;&amp;this.W()===t.W()}}const v=1e3,T=(new function(){}).toString(),x=&quot;!recursion-limit!&quot;;function K(t,r){if(0===r)return x;if(t instanceof Map){var e,i,o=r,a=[];for([e,i]of t.entries()){if(a.length&gt;v){a.push(&quot;[...]&quot;);break}e=w(e,o-1),i=w(i,o-1);a.push(e+&quot;: &quot;+i)}return`Map{${a.join(&quot;, &quot;)}}`}if(t instanceof Set){var n,s=r,l=[];for(n of t){if(l.length&gt;v){l.push(&quot;[...]&quot;);break}l.push(w(n,s-1))}return`Set{${l.join(&quot;, &quot;)}}`}if(void 0!==t[Symbol.iterator]))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART({var h,f=r,c=[];for(h of t){if(c.length&gt;v){c.push(&quot;[...]&quot;);break}c.push(w(h,f-1))}return`${t=Array.isArray(t)?&quot;&quot;:t.constructor.name}[${c.join(&quot;, &quot;)}]`}}function P(t,r){try{var e=String(t);if(e!==T)return e}catch{}var i=t,o=r,a=[];for(s in i)if(i.hasOwnProperty(s)){if(a.length&gt;v){a.push(&quot;[...]&quot;);break}var n=i[s],s=w(s,o-1),n=w(n,o-1);a.push(s+&quot;: &quot;+n)}return void 0===i.constructor?&quot;[an unknown non-primitive value with no constructor]&quot;:(e=(e=i.constructor.name)==={}.constructor.name?&quot;&quot;:`(Type: ${e})`)+`{${a.join(&quot;, &quot;)}}`}function w(t,r=10){return(null===(e=t)?&quot;null&quot;:void 0===e?&quot;undefined&quot;:&quot;string&quot;==typeof e?`&quot;${e}&quot;`:&quot;number&quot;==typeof e?&quot;&quot;+e:void 0)||K(t,r)||P(t,r);var e}function X(t,r){if(t===r||G(t)&amp;&amp;G(r))return!0;var e,i=function(t,r){if(!Z(t)&amp;&amp;void 0!==t.constructor&amp;&amp;t.constructor.prototype.hasOwnProperty(&quot;J&quot;))return t.J(r);if(!Z(r)&amp;&amp;void 0!==r.constructor&amp;&amp;r.constructor.prototype.hasOwnProperty(&quot;J&quot;))return r.J(t)}(t,r);if(void 0!==i)return i;if(Z(t)||Z(r)||t.constructor.name!==r.constructor.name)return!1;if(t)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART( instanceof Map){var o,a,i=t,n=r;if(i.size!==n.size)return!1;for([o,a]of i){if(!n.has(o))return!1;o=n.get(o);if(!X(a,o))return!1}return!0}if(t instanceof Set)return D(t,r);if(e=t,Array.isArray(e)||!L.every(t=&gt;!(e instanceof t))){var s=t,l=r;if(s.length!==l.length)return!1;for(let t=0;t&lt;s.length;t++)if(!X(s[t],l[t]))return!1;return!0}var h,f=t,c=r;if(!D(i=Q(f),Q(c)))return!1;for(h of i)if(h!==Symbol.iterator&amp;&amp;!X(f[h],c[h]))return!1;i=void 0!==f[Symbol.iterator],t=void 0!==c[Symbol.iterator];return i==t&amp;&amp;!(i&amp;&amp;t&amp;&amp;!function(t,r){var e=r[Symbol.iterator]();for(var i of t){var o=e.next();if(o.done||!X(i,o.value))return}return e.next().done}(f,c))}const L=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray];function G(t){return&quot;number&quot;==typeof t&amp;&amp;isNaN(t)}function Z(t){return null==t||&quot;string&quot;==typeof t||&quot;number&quot;==typeof t||&quot;boolean&quot;==typeof t}function D(t,r){if(t.size!==r.size)return!1;for(var e of t)if(!r.has(e))return!1;return!0}function Q(t){var r,e=new)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART( Set;for(r in t)t.hasOwnProperty(r)&amp;&amp;e.add(r);return e}class F{constructor(t,r,e,i,o,a){this.tt=t,this.rt=r,this.altKey=e,this.shiftKey=a,this.ctrlKey=i,this.metaKey=o}J(t){return t instanceof F&amp;&amp;this.tt===t.tt&amp;&amp;X(this.rt,t.rt)&amp;&amp;this.altKey===t.altKey&amp;&amp;this.shiftKey===t.shiftKey&amp;&amp;this.ctrlKey===t.ctrlKey&amp;&amp;this.metaKey===t.metaKey}toString(){return`ChordEvent(
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    inProgress=${this.tt},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    chord=${w(this.rt)},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    altKey=${this.altKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    shiftKey=${this.shiftKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    ctrlKey=${this.ctrlKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    metaKey=${this.metaKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART()`}}const N=new Set([&quot;alt&quot;,&quot;shift&quot;,&quot;control&quot;,&quot;meta&quot;]);class B{constructor(){this.et=new Set,this.it=new Set,this.ot=new Set,this.nt=[]}st(t){return new F(t,new Set(this.ot),this.et.has(&quot;alt&quot;),this.et.has(&quot;control&quot;),this.et.has(&quot;meta&quot;),this.et.has(&quot;shift&quot;))}lt(t){this.nt.push(this.st(t))}ht(){this.it.clear(),this.ot.clear(),this.et.clear()}ft(t){var r,e,i=t.key.toLowerCase();if(&quot;escape&quot;===i&amp;&amp;this.ht(),&quot;keydown&quot;===t.type){for([r,e]of[[t.altKey,&quot;alt&quot;],[t.shiftKey,&quot;shift&quot;],[t.ctrlKey,&quot;control&quot;],[t.metaKey,&quot;meta&quot;]])r?this.et.add(e):this.et.delete(e);N.has(i)||(this.it.add(i),this.ot.add(i)),this.lt(!0)}else{if(&quot;keyup&quot;!==t.type)throw new Error(&quot;Not a recognized key event type: &quot;+t.type);N.has(i)||(this.it.delete(i),this.lt(0&lt;this.it.size),0===this.it.size&amp;&amp;(this.et.clear(),this.ot.clear()))}}}class V{constructor(t,r,e=0,i=!1){this.action=t,this.ct=r,this.vt=e,this.dt=i,this.wt=&quot;idle&quot;,this.ut=-1/0}Xt(){var t=this.ct-(performance.now()-this.ut);if(0&lt;t)this.Zt(t);else{this.wt=&quot;running&quot;;t=performance.now();try{this.act)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ion()}finally{t=performance.now()-t;this.ut=performance.now()+t*this.vt,&quot;running-and-triggered&quot;===this.wt?this.Zt(this.ct):this.wt=&quot;idle&quot;}}}Yt(){switch(this.wt){case&quot;idle&quot;:this.Xt();break;case&quot;waiting&quot;:break;case&quot;running&quot;:this.wt=&quot;running-and-triggered&quot;;break;case&quot;running-and-triggered&quot;:break;default:throw new Error(&quot;Unrecognized throttle state: &quot;+this.wt)}}Zt(e){if(this.wt=&quot;waiting&quot;,this.dt){let t,r=performance.now();(t=()=&gt;{performance.now()&lt;r+e?requestAnimationFrame(t):(this.wt=&quot;idle&quot;,this.ut=-1/0,this.Yt())})()}else setTimeout(()=&gt;{this.wt=&quot;idle&quot;,this.ut=-1/0,this.Yt()},e)}}class f{constructor(t){this.Rt=t}subscribe(t){return this.Rt(t)}static of(...e){return new f(t=&gt;{for(var r of e)t(r);return()=&gt;{}})}yt(){let r=[];return this.subscribe(t=&gt;r.push(t))(),r}map(e){return new f(r=&gt;this.subscribe(t=&gt;r(e(t))))}filter(e){return new f(r=&gt;this.subscribe(t=&gt;{e(t)&amp;&amp;r(t)}))}Mt(s,l){return new f(r=&gt;{let e=!1,i=!1,o,a,t=this.subscribe(t=&gt;{o=t,e=!0,i&amp;&amp;r(l(o,a))}),n=s.subscribe(t=&gt;{a=t,i=!0,e&amp;&amp;r(l(o,a))});return()=&gt;{t()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(),n()}})}static It(){return new f(t=&gt;{let r,e=!1;return(r=()=&gt;{e||(t(void 0),window.requestAnimationFrame(r))})(),()=&gt;{e=!0}})}bt(){return new f(e=&gt;{let i=()=&gt;{},o=!1,t=this.subscribe(t=&gt;{var r;o||(r=i,i=t.subscribe(e),r())});return()=&gt;{o=!0,i(),t()}})}kt(r){return this.map(t=&gt;(r(t),t))}At(){return new f(r=&gt;{let e=[];return e.push(this.subscribe(t=&gt;e.push(t.subscribe(r)))),()=&gt;{for(var t of e)t()}})}Et(a){return new f(t=&gt;{let r=void 0,e=!1,i=new V(()=&gt;{e||t(r)},a),o=this.subscribe(t=&gt;{r=t,i.Yt()});return()=&gt;{e=!0,o()}})}static Ct(r,e){return new f(t=&gt;(r.addEventListener(e,t),()=&gt;r.removeEventListener(e,t)))}_t(t){return new f(r=&gt;{let e=t;return this.subscribe(t=&gt;{0&lt;e?--e:r(t)})})}gt(t=void 0){let o=t||((t,r)=&gt;t===r);return new f(r=&gt;{let e=!1,i=void 0;return this.subscribe(t=&gt;{e&amp;&amp;o(i,t)||(i=t,e=!0,r(t))})})}}class j{constructor(){this.St=[],this.Ot=new f(t=&gt;{this.St.push(t);let r=!1;return()=&gt;{r||(r=!0,this.St.splice(this.St.indexOf(t),1))}})}Tt(){return this.Ot}send(t){for(var r of this.St)r(t)}}class J{const)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ructor(t=void 0){this.xt=t,this.Kt=new j,this.Ot=new f(t=&gt;(t(this.xt),this.Kt.Tt().subscribe(t)))}Tt(){return this.Ot}set(t){this.xt=t,this.Kt.send(t)}get(){return this.xt}}class r{constructor(t,r,e){if(r&lt;0||r&gt;=t.length)throw new Error(&quot;Bad index: &quot;+{history:t,index:r,Pt:e});if(!Array.isArray(t))throw new Error(&quot;Bad history: &quot;+{history:t,index:r,Pt:e});this.history=t,this.index=r,this.Pt=e,this.Lt=new j,this.Gt=new J(this.history[this.index])}Dt(){return this.Lt.Tt()}Qt(){return this.Gt.Tt()}Ft(){return this.Gt.get()}static Nt(t){return new r([t],0,!1)}Ut(){return 0===this.index&amp;&amp;!this.Pt}zt(){return this.index===this.history.length-1}clear(t){this.history=[t],this.index=0,this.Pt=!1,this.Gt.set(t),this.Lt.send(t)}Ht(){this.Pt=!0,this.Lt.send(void 0)}$t(){this.Pt=!1;var t=this.history[this.index];return this.Gt.set(t),this.Lt.send(t),t}commit(t){t===this.history[this.index]?this.$t():(this.Pt=!1,this.index+=1,this.history.splice(this.index,this.history.length-this.index),this.history.push(t),this.Gt.set(t),th)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(is.Lt.send(t))}qt(){if(!this.Pt){if(0===this.index)return;--this.index}this.Pt=!1;var t=this.history[this.index];return this.Gt.set(t),this.Lt.send(t),t}Wt(){var t;if(this.index+1!==this.history.length)return this.index+=1,this.Pt=!1,t=this.history[this.index],this.Gt.set(t),this.Lt.send(t),t}toString(){return&quot;Revision(&quot;+w({index:this.index,count:this.history.length,Bt:this.Pt,head:this.history[this.index]})+&quot;)&quot;}J(t){return t instanceof r&amp;&amp;this.index===t.index&amp;&amp;this.Pt===t.Pt&amp;&amp;X(this.history,t.history)}}let lt=32;function tt(i,o,a,n){var t,r=i.canvas.width/2,e=o.Vt();e.sort((t,r)=&gt;{var[t,e]=n(t),[r,i]=n(r);return e!==i?e-i:t-r});let s=new Map,l=void 0,h=0,f=0,c=0,v=0;for(t of e){var[K,d]=n(t);f+=lt,l!==d?(l=d,h=1.5*r,c=Math.max(c,v),v=0,f+=.25*lt):(h+=.25*nt,v++),s.set(K+&quot;,&quot;+d,[h,f])}let w=lt+nt*c*.25,u=(t,r)=&gt;{var[t,e]=n(t);return[t,e,r]=[[t,e,r]][0],t=t+&quot;,&quot;+e,s.has(t)?([e,t]=s.get(t),[e+(r-o.jt)*w,t]):[void 0,void 0]};var X=Math.floor(i.canvas.width/4/w),Z=Math.max(0,o.jt-X+1),Y=o.jt+X+2;i.save();try{i.clea)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(rRect(r,0,r,i.canvas.height);for(let t=0;t&lt;a.length;t++)if(t&lt;4){R=void 0;y=void 0;M=void 0;I=void 0;m=void 0;P=void 0;L=void 0;_=void 0;g=void 0;S=void 0;p=void 0;b=void 0;O=void 0;T=void 0;k=void 0;G=void 0;D=void 0;Q=void 0;F=void 0;A=void 0;E=void 0;C=void 0;var R=i;var y=u;var M=a[t];var I=t;var m=Z;var P=Y;var L=w;let r,e;e=L,0===I?r=10:1===I?r=5:2===I?r=0:3===I&amp;&amp;(r=-5);for(let t=m;t&lt;=P;t++){var p,b,k,A,E,C,_=M.Jt(t);for([p,b]of _.tr.entries()){var[g,S]=y(p,t);if(void 0!==g&amp;&amp;void 0!==S){if(&quot;X&quot;===b)R.fillStyle=&quot;red&quot;;else if(&quot;Y&quot;===b)R.fillStyle=&quot;green&quot;;else{if(&quot;Z&quot;!==b)throw new Error(&quot;Not a pauli: &quot;+b);R.fillStyle=&quot;blue&quot;}R.fillRect(+g,S-r,e,5)}}for(k of _.rr){var[O,T]=y(k,t-.5);void 0!==O&amp;&amp;void 0!==T&amp;&amp;(R.fillStyle=&quot;magenta&quot;,R.fillRect(+O-8,T-r-8,e+16,21),R.fillStyle=&quot;black&quot;,R.fillRect(+O,T-r,e,5))}for({er:A,ir:E,color:C}of _.ar){var[G,D]=y(A,t),[Q,F]=y(E,t);&quot;X&quot;===C?R.strokeStyle=&quot;red&quot;:&quot;Y&quot;===C?R.strokeStyle=&quot;green&quot;:&quot;Z&quot;===C?R.strokeStyle=&quot;blue&quot;:R.strokeStyle=&quot;magenta&quot;,R.lineWidth=8,st(R,G,D,Q,F),R.lineWidth=)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(1}}}i.globalAlpha*=.5,i.fillStyle=&quot;black&quot;,i.fillRect(1.5*r-1.3*nt,0,w,i.canvas.height),i.globalAlpha*=2,i.strokeStyle=&quot;black&quot;,i.fillStyle=&quot;black&quot;;for(var N of e){var[U,z]=u(N,Z-1),[H,$]=u(N,Y+1);i.beginPath(),i.moveTo(U,z),i.lineTo(H,$),i.stroke()}i.textAlign=&quot;right&quot;,i.textBaseline=&quot;middle&quot;;for(var x of e){var[q,W]=u(x,Z-1),B=o.nr.L[2*x],V=o.nr.L[2*x+1];i.fillText(B+`,${V}:`,q,W)}for(let r=Z;r&lt;=Y;r++){var j=t=&gt;u(t,r),J=o.nr.G[r];if(void 0!==J)for(var tt of J.P())tt.I(j,i)}i.globalAlpha=.25,i.setLineDash([1,1]);let t=0;for(var rt of e)t=Math.max(t,n(rt)[0]);for(var et of e){var[it,ot]=u(et,Z-1),[,at]=n(et);i.beginPath(),i.moveTo(it,ot),i.lineTo(t+.25,at),i.stroke()}}finally{i.restore()}}class rt{constructor(t,r,e){this.tr=t,this.rr=r,this.ar=e}}class et{constructor(t){this.sr=t}Jt(t){let r=this.sr.get(t);return r=void 0===r?new rt(new Map,new Set,[]):r}static lr(r,e){var i=new et(new Map);let o=new Map;for(let t=0;t&lt;r.G.length;t++){var a,n=r.G[t],s=o,l=(o=n.S(o,e),new Set);for(a of[...o.keys()]){var h=o.get(a))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(;h.startsWith(&quot;ERR:&quot;)&amp;&amp;(l.add(a),o.set(a,h.substring(4))),&quot;I&quot;===o.get(a)&amp;&amp;o.delete(a)}var f,c=[];for(f of n.P())if(2===f.Z.t&amp;&amp;!f.Z.i){var v,[d,w]=f.R,u=new Set;for(v of f.R){var X=o.get(v),Z=s.get(v);X!==Z&amp;&amp;(void 0!==X&amp;&amp;u.add(X),void 0!==Z)&amp;&amp;u.add(Z)}if(0&lt;u.size){let t=&quot;I&quot;;1===u.size&amp;&amp;(t=[...u][0]),c.push({er:d,ir:w,color:t})}}(0&lt;o.size||0&lt;l.size||0&lt;c.size)&amp;&amp;i.sr.set(t,new rt(o,l,c))}return i}}const z=-d+Math.floor(d/4)+.5,H=-d+Math.floor(d/4)+.5;function $(t,r){var e,i,o,a;return void 0!==t&amp;&amp;void 0!==r&amp;&amp;(e=t/d,i=r/d,e=Math.floor(2*e+.5)/2,i=Math.floor(2*i+.5)/2,o=e*d,a=i*d,Math.abs(o-t)&lt;=nt)&amp;&amp;Math.abs(a-r)&lt;=nt&amp;&amp;e%1==i%1?[e,i]:[void 0,void 0]}let it=!0;function q(t,r){t.save();try{it&amp;&amp;r()}finally{t.restore()}}function ot(P,L){let G=L.nr,r=0;for(var t of G.G)for(var e of t.A){var i=e.Z;&quot;MARKX&quot;!==i.name&amp;&amp;&quot;MARKY&quot;!==i.name&amp;&amp;&quot;MARKZ&quot;!==i.name||(r=Math.max(r,e.Y[0]+1))}let D=(t,r)=&gt;[t*d-z,r*d-H],Q=t=&gt;{var r=G.L[2*t],t=G.L[2*t+1];return D(r,t)},F=[];for(let t=0;t&lt;r;t++)F.push(et.lr(G,t));let N=new Set;for(var o of G.)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(F()){var a=G.L[2*o],o=G.L[2*o+1];N.add(a+&quot;,&quot;+o)}q(P,()=&gt;{P.fillStyle=&quot;white&quot;,P.clearRect(0,0,P.canvas.width,P.canvas.height);var[t,r]=$(L.hr,L.cr);let e=L.jt;for(let t=0;t&lt;=L.jt;t++)for(var K of G.G[t].A)if(&quot;POLYGON&quot;===K.Z.name){e=t;break}var i,o,a=[...G.G[e].A];a.sort((t,r)=&gt;r.R.length-t.R.length);for(i of a)&quot;POLYGON&quot;===i.Z.name&amp;&amp;i.I(Q,P);q(P,()=&gt;{G.F();P.strokeStyle=&quot;black&quot;;for(let r=0;r&lt;100;r+=.5)for(let t=r%1;t&lt;100;t+=1){var[e,i]=D(r,t),o=(r%1==.5?P.fillStyle=&quot;pink&quot;:P.fillStyle=&quot;white&quot;,!N.has(r+&quot;,&quot;+t));o&amp;&amp;(P.globalAlpha*=.25),P.fillRect(e-nt,i-nt,2*nt,2*nt),P.strokeRect(e-nt,i-nt,2*nt,2*nt),o&amp;&amp;(P.globalAlpha*=4)}});for(let t=0;t&lt;F.length;t++){v=c=f=w=d=h=l=s=n=void 0;var n=P,s=L,l=Q,h=F[t];if(t,void 0!==(h=h.Jt(s.jt).ar))for(var{er:f,ir:c,color:v}of h){var[f,d]=l(f),[c,w]=l(c);&quot;X&quot;===v?n.strokeStyle=&quot;red&quot;:&quot;Y&quot;===v?n.strokeStyle=&quot;green&quot;:&quot;Z&quot;===v?n.strokeStyle=&quot;blue&quot;:n.strokeStyle=&quot;magenta&quot;,n.lineWidth=8,st(n,f,d,c,w),n.lineWidth=1}}for(o of G.G[L.jt].P())&quot;POLYGON&quot;!==o.Z.name&amp;&amp;o.I(Q,P);q(P,()=&gt;{P.globalAlpha*=)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.25;for(var[t,r]of L.vr.values()){var[t,r]=D(t,r);P.fillStyle=&quot;yellow&quot;,P.fillRect(t-1.25*nt,r-1.25*nt,2.5*nt,2.5*nt)}}),q(P,()=&gt;{P.globalAlpha*=.5;for(var[t,r]of L.dr.values()){var[t,r]=D(t,r);P.fillStyle=&quot;blue&quot;,P.fillRect(t-1.25*nt,r-1.25*nt,2.5*nt,2.5*nt)}});for(let t=0;t&lt;F.length;t++){Z=x=T=O=S=g=C=E=_=X=u=A=k=b=p=m=I=M=y=R=Y=void 0;var u,X,Z,Y=P,R=L,y=Q,M=F[t],I=t,{dx:m,dy:p,m:b,p:k}=U(I),A=[];for([u,X]of M.Jt(R.jt).tr.entries())A.push([X,y(u)]);if(0&lt;A.length){A.every(t=&gt;&quot;X&quot;===t[0])?Y.fillStyle=&quot;red&quot;:A.every(t=&gt;&quot;Y&quot;===t[0])?Y.fillStyle=&quot;green&quot;:A.every(t=&gt;&quot;Z&quot;===t[0])?Y.fillStyle=&quot;blue&quot;:Y.fillStyle=&quot;black&quot;,Y.strokeStyle=Y.fillStyle;var E,C,_=A.map(t=&gt;t[1]);let n=0,s=0;for([E,C]of _)n+=E,s+=C;n/=_.length,s/=_.length,_.sort((t,r)=&gt;{var[t,e]=t,[r,i]=r;let o=Math.atan2(e-s,t-n),a=Math.atan2(i-s,r-n);return t===n&amp;&amp;e===s&amp;&amp;(o=-100),r===n&amp;&amp;i===s&amp;&amp;(a=-100),o-a}),W(Y,_),Y.globalAlpha*=.25,Y.fill(),Y.globalAlpha*=4,Y.lineWidth=3,Y.stroke(),Y.lineWidth=1}if(I&lt;4)for(var[g,[S,O]]of A){if(&quot;X&quot;===g)Y.fillStyle=&quot;red&quot;;else if()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&quot;Y&quot;===g)Y.fillStyle=&quot;green&quot;;else{if(&quot;Z&quot;!==g)throw new Error(&quot;Not a pauli: &quot;+g);Y.fillStyle=&quot;blue&quot;}Y.fillRect(S-m,O-p,b,k)}for(Z of M.Jt(R.jt).rr){var[T,x]=y(Z);Y.fillStyle=&quot;magenta&quot;,Y.fillRect(T-m-8,x-p-8,b+16,k+16),Y.fillStyle=&quot;black&quot;,Y.fillRect(T-m,x-p,b,k)}}void 0!==t&amp;&amp;(P.save(),P.globalAlpha*=.5,[a,t]=D(t,r),P.fillStyle=&quot;red&quot;,P.fillRect(a-nt,t-nt,2*nt,2*nt),P.restore()),q(P,()=&gt;{var t,r,e,i,o,a;P.globalAlpha*=.25,P.fillStyle=&quot;blue&quot;,void 0!==L.wr&amp;&amp;void 0!==L.hr&amp;&amp;(t=Math.min(L.hr,L.wr),r=Math.max(L.hr,L.wr),e=Math.min(L.cr,L.ur),i=Math.max(L.cr,L.ur),--t,r+=1,--e,i+=1,t-=z,r-=z,e-=H,i-=H,P.fillRect(t,e,r-t,i-e));for([o,a]of L.Xr){var[n,s]=D(o,a);P.fillRect(n-nt,s-nt,2*nt,2*nt)}})}),P.save();try{P.strokeStyle=&quot;black&quot;;for(let r=0;r&lt;G.G.length;r++){var n=!F.every(t=&gt;0===t.Jt(r).rr.size);r===L.jt?P.fillStyle=&quot;red&quot;:(n&amp;&amp;(P.fillStyle=&quot;magenta&quot;,P.fillRect(-2,5*r-2,14,8)),P.fillStyle=&quot;black&quot;),P.fillRect(0,5*r,10,4)}}finally{P.restore()}tt(P,L,F,Q)}class at{constructor(t,r,e,i,o,a,n,s,l){for(this.nr=t.C(),this.jt=r,t)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(his.dr=new Map(e.entries()),this.vr=new Map(i.entries()),this.hr=o,this.cr=a,this.wr=n,this.ur=s,this.Xr=[...l];this.nr.G.length&lt;=this.jt;)this.nr.G.push(new A)}Zr(){return this.nr.F()}Vt(){let r=this.Zr();var t=[];if(0&lt;this.vr.size){var e,i=this.nr.j();for(e of this.vr.keys()){var o=i.get(e);void 0!==o&amp;&amp;t.push(o)}}else t.push(...r.values());return t.filter(t=&gt;r.has(t))}}function ht(r){let e=[1,0],i=[0,1];var o=(t,r)=&gt;[t-r,t+r];r=(r%8+8)%8;for(let t=0;t&lt;r;t++)e=o(e[0],e[1]),i=o(i[0],i[1]);return(t,r)=&gt;[e[0]*t+i[0]*r,e[1]*t+i[1]*r]}function ft(){try{return window.self===window.top}catch(t){}}class ct{constructor(){this.Yr=!1,this.Rr=void 0}yr(){this.Rr={Mr:!0}}Ir(t){this.Rr=t}mr(){this.Rr=void 0}pr(t,r){if(!r.startsWith(&quot;#&quot;))throw new Error(&#x27;&quot;Expected a hash URL: &#x27;+{br:t,kr:r});if(ft()&amp;&amp;this.Rr!==t)if(this.Yr)document.location.hash=r;else try{void 0===this.Rr?history.replaceState(t,&quot;&quot;,r):(history.pushState(t,&quot;&quot;,r),this.Rr=void 0)}catch(t){console.warn(&quot;Calling &#x27;history.replaceState/pushState&#x27; failed. Falling b)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ack to setting location.hash.&quot;,t),this.Yr=!0,document.location.hash=r}}}function vt(t){return&quot;#circuit=&quot;+(t=-1===(t=t.replaceAll(&quot;QUBIT_COORDS&quot;,&quot;Q&quot;).replaceAll(&quot;, &quot;,&quot;,&quot;).replaceAll(&quot;) &quot;,&quot;)&quot;).replaceAll(&quot; &quot;,&quot;_&quot;).replaceAll(&quot;\n&quot;,&quot;;&quot;)).indexOf(&quot;%&quot;)&amp;&amp;-1===t.indexOf(&quot;&amp;&quot;)?t:encodeURIComponent(t))}let c=document.getElementById(&quot;toolbox&quot;),R=10.5,y=[&quot;H&quot;,&quot;S&quot;,&quot;R&quot;,&quot;M&quot;,&quot;C&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;],dt=[1,2,2,2,void 0,-1,-1,-1,-1];let wt=new Map([[&quot;0,0&quot;,k.get(&quot;H_YZ&quot;)],[&quot;0,1&quot;,k.get(&quot;H&quot;)],[&quot;0,2&quot;,k.get(&quot;H_XY&quot;)],[&quot;1,0&quot;,k.get(&quot;SQRT_X&quot;)],[&quot;1,1&quot;,k.get(&quot;SQRT_Y&quot;)],[&quot;1,2&quot;,k.get(&quot;S&quot;)],[&quot;2,0&quot;,k.get(&quot;RX&quot;)],[&quot;2,1&quot;,k.get(&quot;RY&quot;)],[&quot;2,2&quot;,k.get(&quot;R&quot;)],[&quot;3,0&quot;,k.get(&quot;MX&quot;)],[&quot;3,1&quot;,k.get(&quot;MY&quot;)],[&quot;3,2&quot;,k.get(&quot;M&quot;)],[&quot;4,0&quot;,k.get(&quot;CX&quot;)],[&quot;4,1&quot;,k.get(&quot;CY&quot;)],[&quot;4,2&quot;,k.get(&quot;CZ&quot;)],[&quot;5,0&quot;,k.get(&quot;MARKX&quot;).X(0)],[&quot;5,1&quot;,k.get(&quot;MARKY&quot;).X(0)],[&quot;5,2&quot;,k.get(&quot;MARKZ&quot;).X(0)],[&quot;6,0&quot;,k.get(&quot;MARKX&quot;).X(1)],[&quot;6,1&quot;,k.get(&quot;MARKY&quot;).X(1)],[&quot;6,2&quot;,k.get(&quot;MARKZ&quot;).X(1)],[&quot;7,0&quot;,k.get(&quot;MARKX&quot;).X(2)],[&quot;7,1&quot;,k.get(&quot;MARKY&quot;).X(2)],[&quot;7,2&quot;,k.get(&quot;MARKZ&quot;).X(2)],[&quot;8,0&quot;,k.get(&quot;MARKX&quot;).X(3)],[&quot;8,1&quot;,k)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.get(&quot;MARKY&quot;).X(3)],[&quot;8,2&quot;,k.get(&quot;MARKZ&quot;).X(3)],[&quot;5,-1&quot;,k.get(&quot;MARK&quot;).X(0)],[&quot;6,-1&quot;,k.get(&quot;MARK&quot;).X(1)],[&quot;7,-1&quot;,k.get(&quot;MARK&quot;).X(2)],[&quot;8,-1&quot;,k.get(&quot;MARK&quot;).X(3)]]);function ut(t){var r,e=function(t){var r,e;if(!t.ctrlKey)return r=+t.rt.has(&quot;x&quot;),e=+t.rt.has(&quot;y&quot;),t=+t.rt.has(&quot;z&quot;),r&amp;&amp;!e&amp;&amp;!t||!r&amp;&amp;e&amp;&amp;t?{Ar:0,strength:Math.max(r,Math.min(e,t))}:!r&amp;&amp;e&amp;&amp;!t||r&amp;&amp;!e&amp;&amp;t?{Ar:1,strength:Math.max(e,Math.min(r,t))}:!r&amp;&amp;!e&amp;&amp;t||r&amp;&amp;e&amp;&amp;!t?{Ar:2,strength:Math.max(t,Math.min(r,e))}:void 0}(t),t=function(e){if(!e.ctrlKey){let r=void 0;for(let t=0;t&lt;y.length;t++){var i=e.rt.has(y[t].toLowerCase());0&lt;i&amp;&amp;(void 0===r||i&gt;r.strength)&amp;&amp;(r={Er:t,strength:i})}return r}}(t);let i=e,o=(void 0!==t&amp;&amp;void 0===e&amp;&amp;(r=dt[t.Er],i=void 0===r?void 0:{strength:0,Ar:r}),void 0);return void 0!==i&amp;&amp;void 0!==t&amp;&amp;(r=t.Er+&quot;,&quot;+i.Ar,wt.has(r))&amp;&amp;(o=wt.get(r)),{Cr:e,_r:i,gr:t,Sr:o}}const e=-d+Math.floor(d/4)+.5,o=-d+Math.floor(d/4)+.5;var Xt=document.getElementById(&quot;btnUndo&quot;),Zt=document.getElementById(&quot;btnRedo&quot;),Yt=document.getElementById(&quot;btnClearMarkers&quot;);const )CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(M=document.getElementById(&quot;btnShowHideImportExport&quot;);var Rt=document.getElementById(&quot;btnNextLayer&quot;),yt=document.getElementById(&quot;btnPrevLayer&quot;),Mt=document.getElementById(&quot;btnRotate45&quot;),It=document.getElementById(&quot;btnRotate45Counter&quot;),t=document.getElementById(&quot;btnExport&quot;),mt=document.getElementById(&quot;btnImport&quot;),pt=document.getElementById(&quot;clear&quot;);const I=document.getElementById(&quot;txtStimCircuit&quot;);I.addEventListener(&quot;keyup&quot;,t=&gt;t.stopPropagation()),I.addEventListener(&quot;keydown&quot;,t=&gt;t.stopPropagation());let m=new class{constructor(t){this.rev=r.Nt(&quot;&quot;),this.canvas=t,this.cr=void 0,this.hr=void 0,this.Or=new B,this.jt=0,this.dr=new Map,this.vr=new Map,this.wr=void 0,this.ur=void 0,this.Tr=new J(this.Kr(void 0))}Pr(){for(var t=u.D(this.rev.Ft());t.G.length&lt;=this.jt;)t.G.push(new A);return t}Lr(){this.dr.clear(),this.Gr()}Dr(t){var r,e=this.Pr(),i=e.j();for(r of this.dr.keys()){var o=i.get(r);void 0!==o&amp;&amp;e.G[this.jt].T(o)}this.Qr(e,t)}Fr(t){var r=this.Pr();r.G.splice(this.jt,1),this.Qr(r,t)}Nr(t){var r=this.Pr();r.G.sp)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(lice(this.jt,0,new A),this.Qr(r,t)}qt(){this.rev.qt()}Wt(){this.rev.Wt()}Qr(t,r){r?this.Ur(t):this.commit(t)}commit(t){for(;0&lt;t.G.length&amp;&amp;t.G[t.G.length-1].O();)t.G.pop();this.rev.commit(t.W())}Ur(t){this.rev.Ht(),this.Tr.set(this.Kr(t))}Kr(t){return void 0===t&amp;&amp;(t=this.Pr()),new at(t,this.jt,this.dr,this.vr,this.hr,this.cr,this.wr,this.ur,this.zr(this.Or.et.has(&quot;alt&quot;)))}Gr(){var t=this.Tr.get().nr;this.Tr.set(this.Kr(t))}Hr(){this.commit(new u(new Float64Array([]),[]))}$r(){var t,r=this.Pr();for(t of r.G)t.A=t.A.filter(t=&gt;&quot;MARKX&quot;!==t.Z.name&amp;&amp;&quot;MARKY&quot;!==t.Z.name&amp;&amp;&quot;MARKZ&quot;!==t.Z.name);this.commit(r)}zr(i){var t=this.hr,r=this.cr,o=this.wr,a=this.ur,n=[];if(void 0!==t&amp;&amp;void 0!==o){var[s,l]=$(o,a),h=Math.min(t,o),f=Math.max(t,o),c=Math.min(r,a),v=Math.max(r,a),t=d/4-nt;h+=t,f-=t,c+=t,v-=t,h=Math.floor(2*h/d+.5)/2,f=Math.floor(2*f/d+.5)/2,c=Math.floor(2*c/d+.5)/2,v=Math.floor(2*v/d+.5)/2;let e=1;h!=f&amp;&amp;c!=v||(e=2);for(let r=h;r&lt;=f;r+=.5)for(let t=c;t&lt;=v;t+=.5)r%1!=t%1||i&amp;&amp;(s%e!=r%e||l%e!=t%e)||n.push([r,t])}return n)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(}qr(o,t){let r=this.Pr();var e;r=r.U(o),t||(this.vr=(e=t=&gt;{var r,e,i=new Map;for([r,e]of t.values())[r,e]=o(r,e),i.set(r+&quot;,&quot;+e,[r,e]);return i})(this.vr),this.dr=e(this.dr)),this.Qr(r,t)}Wr(t,r){let e=ht(t),i=this.Pr().U(e).H();this.qr((t,r)=&gt;([t,r]=e(t,r),i(t,r)),r)}Br(t){this.jt=Math.max(t,0),this.Gr()}Vr(t,r,e){r||e||this.dr.clear();for(var[i,o]of t){var a=i+&quot;,&quot;+o;e&amp;&amp;this.dr.has(a)?this.dr.delete(a):this.dr.set(a,[i,o])}this.Gr()}jr(t,r){var e,i=this.Pr().V(this.dr.values()),o=i.j(),a=new Set;for(e of this.dr.keys())a.add(o.get(e));var n,s=new Map,l=i.G[this.jt];for(n of[...a]){var h=l.k.get(n);if(void 0!==h)if(&quot;RX&quot;===h.Z.name||&quot;MX&quot;===h.Z.name||&quot;MRX&quot;===h.Z.name)s.set(n,&quot;X&quot;);else if(&quot;RY&quot;===h.Z.name||&quot;MY&quot;===h.Z.name||&quot;MRY&quot;===h.Z.name)s.set(n,&quot;Y&quot;);else if(&quot;R&quot;===h.Z.name||&quot;M&quot;===h.Z.name||&quot;MR&quot;===h.Z.name)s.set(n,&quot;Z&quot;);else if(&quot;MXX&quot;===h.Z.name||&quot;MYY&quot;===h.Z.name||&quot;MZZ&quot;===h.Z.name){var f,c=h.Z.name[1];for(f of h.R)s.set(f,c),a.add(f)}}var v,d=new Set(s.values());d.delete(void 0);let w;w=1===d.size?[...d][0]:&quot;Z&quot;;for)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART((v of a){let t=s.get(v);void 0===t&amp;&amp;(t=w);var u=k.get(&quot;MARK&quot;+t).X(r);l.put(new b(u,new Float32Array([r]),new Uint32Array([v])))}this.Qr(i,t)}Jr(t,r,e){var i,o=this.Pr().V(this.dr.values()),a=o.j();for(i of this.dr.keys())o.G[this.jt].put(new b(r,new Float32Array(e),new Uint32Array([a.get(i)])));this.Qr(o,t)}te(t,r,e){let i=this.Pr();var[o,a]=$(this.hr,this.cr),[n,s]=Y(this.dr.values());if(void 0!==o&amp;&amp;void 0!==n&amp;&amp;!this.dr.has(o+&quot;,&quot;+a)){var l,h,f=o-n,c=a-s,v=[];for([l,h]of this.dr.values())v.push([l,h]),v.push([l+f,h+c]);var d=(i=i.V(v)).j();for(let t=0;t&lt;v.length;t+=2){var[w,u]=v[t],[X,Z]=v[t+1],w=d.get(w+&quot;,&quot;+u),u=d.get(X+&quot;,&quot;+Z);i.G[this.jt].put(new b(r,new Float32Array(e),new Uint32Array([w,u])))}}this.Qr(i,t)}re(t,r,e){if(0!==this.dr.size){var i,n=[];let o=0,a=0;for(i of this.dr.values())n.push(i),o+=i[0],a+=i[1];o/=n.length,a/=n.length,n.sort((t,r)=&gt;{var[t,e]=t,[r,i]=r;return Math.atan2(e-a,t-o)-Math.atan2(i-a,r-o)});var s=this.Pr().V(this.dr.values()),l=s.j(),h=new Uint32Array(this.dr.size);for(let t=0;t&lt;n)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.length;t++){var[f,c]=n[t];h[t]=l.get(f+&quot;,&quot;+c)}s.G[this.jt].put(new b(r,new Float32Array(e),h)),this.Qr(s,t)}}ee(t,r,e=void 0){void 0===e&amp;&amp;(e=void 0===r.u?[]:[r.u]),1===r.t?this.Jr(t,r,e):2===r.t?this.te(t,r,e):this.re(t,r,e)}}(document.getElementById(&quot;cvn&quot;));function bt(){var t=m.Pr().W().replaceAll(&quot;\nPOLYGON&quot;,&quot;\n#!pragma POLYGON&quot;).replaceAll(&quot;\nMARK&quot;,&quot;\n#!pragma MARK&quot;),r=I;r.value=t+&quot;\n&quot;,r.focus(),r.select()}t.addEventListener(&quot;click&quot;,t=&gt;{bt()}),mt.addEventListener(&quot;click&quot;,t=&gt;{var r=I.value,r=u.D(r.replaceAll(&quot;\n#!pragma &quot;,&quot;\n&quot;));m.commit(r)}),M.addEventListener(&quot;click&quot;,t=&gt;{var r=document.getElementById(&quot;divImportExport&quot;);&quot;none&quot;===r.style.display?(r.style.display=&quot;block&quot;,M.textContent=&quot;Hide Import/Export&quot;,bt()):(r.style.display=&quot;none&quot;,M.textContent=&quot;Show Import/Export&quot;,I.value=&quot;&quot;),setTimeout(()=&gt;{window.scrollTo(0,0)},0)}),pt.addEventListener(&quot;click&quot;,t=&gt;{m.Hr()}),Xt.addEventListener(&quot;click&quot;,t=&gt;{m.qt()}),Zt.addEventListener(&quot;click&quot;,t=&gt;{m.Wt()}),Yt.addEventListener(&quot;click&quot;,t=&gt;{m.$r()}),Mt.addEventListener(&quot;c)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(lick&quot;,t=&gt;{m.Wr(1,!1)}),It.addEventListener(&quot;click&quot;,t=&gt;{m.Wr(-1,!1)}),Rt.addEventListener(&quot;click&quot;,t=&gt;{m.Br(m.jt+1)}),yt.addEventListener(&quot;click&quot;,t=&gt;{m.Br(m.jt-1)}),window.addEventListener(&quot;resize&quot;,t=&gt;{m.canvas.width=m.canvas.scrollWidth,m.canvas.height=m.canvas.scrollHeight,m.Gr()}),m.canvas.addEventListener(&quot;mousemove&quot;,t=&gt;{m.hr=t.offsetX+e,m.cr=t.offsetY+o,m.wr-e&lt;10&amp;&amp;m.hr-e&lt;10&amp;&amp;1===t.buttons?(m.Br(Math.floor(t.offsetY/5)),t.preventDefault()):m.Gr()}),m.canvas.addEventListener(&quot;mousedown&quot;,t=&gt;{m.hr=t.offsetX+e,m.cr=t.offsetY+o,m.wr=t.offsetX+e,m.ur=t.offsetY+o,m.wr-e&lt;10&amp;&amp;1===t.buttons?m.Br(Math.floor(t.offsetY/5)):m.Gr()}),m.canvas.addEventListener(&quot;mouseup&quot;,t=&gt;{var r=m.zr(t.altKey);m.wr=void 0,m.ur=void 0,m.hr=t.offsetX+e,m.cr=t.offsetY+o,m.Vr(r,t.shiftKey,t.ctrlKey)});let kt=void 0;async function At(){let e=m.Pr();e.G=[e.G[m.jt]],0&lt;m.dr.size&amp;&amp;(e.G[0]=e.G[0].g(t=&gt;{var r=e.L[2*t],t=e.L[2*t+1];return m.dr.has(r+&quot;,&quot;+t)}),[r,t]=Y(m.dr.values()),e=e.q(-r,-t));var t,r=e.W();try{await navigator.clipboard.writeText(r))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,kt=void 0}catch(t){kt=r,console.error(t)}}async function Et(e){let i;try{i=await navigator.clipboard.readText()}catch(t){i=kt,console.error(t)}if(void 0!==i){let r=u.D(i);if(1!==r.G.length)throw new Error(i);let t=m.Pr();0&lt;m.dr.size&amp;&amp;([o,a]=Y(m.dr.values()),r=r.q(o,a));var o,a,n=[];for(let t=0;t&lt;r.L.length;t+=2)n.push([r.L[t],r.L[t+1]]);var s,l,h=(t=t.V(n)).j();for(s of m.dr.keys()){var f=h.get(s);void 0!==f&amp;&amp;t.G[m.jt].T(f)}for(l of r.G[0].P()){var c,v=[];for(c of l.R){var d=r.L[2*c],w=r.L[2*c+1];v.push(h.get(d+&quot;,&quot;+w))}t.G[m.jt].put(new b(l.Z,l.Y,new Uint32Array(v)))}m.Qr(t,e)}}const Ct=function(){let o=new Map;o.set(&quot;shift+t&quot;,t=&gt;m.Wr(-1,t)),o.set(&quot;t&quot;,t=&gt;m.Wr(1,t)),o.set(&quot;escape&quot;,()=&gt;m.Lr),o.set(&quot;delete&quot;,t=&gt;m.Dr(t)),o.set(&quot;backspace&quot;,t=&gt;m.Dr(t)),o.set(&quot;ctrl+delete&quot;,t=&gt;m.Fr(t)),o.set(&quot;ctrl+insert&quot;,t=&gt;m.Nr(t)),o.set(&quot;ctrl+backspace&quot;,()=&gt;m.Fr),o.set(&quot;ctrl+z&quot;,t=&gt;{t||m.qt()}),o.set(&quot;ctrl+y&quot;,t=&gt;{t||m.Wt()}),o.set(&quot;ctrl+shift+z&quot;,t=&gt;{t||m.Wt()}),o.set(&quot;ctrl+c&quot;,async t=&gt;{t||await At()}),o.set(&quot;ctrl+v&quot;,Et),o.set(&quot;ctrl)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(+x&quot;,async t=&gt;{await At(),m.Dr(t)}),o.set(&quot;l&quot;,t=&gt;{t||(m.vr=new Map(m.dr.entries()),m.Gr())}),o.set(&quot; &quot;,t=&gt;{var r,e=m.Pr(),i=e.j();for(r of m.dr.keys()){var o=i.get(r);void 0!==o&amp;&amp;e.G[m.jt].K(o)}m.Qr(e,t)}),o.set(&quot;q&quot;,t=&gt;{t||m.Br(m.jt-1)}),o.set(&quot;e&quot;,t=&gt;{t||m.Br(m.jt+1)});for(let[t,r]of[[&quot;1&quot;,0],[&quot;2&quot;,1],[&quot;3&quot;,2],[&quot;4&quot;,3],[&quot;5&quot;,4],[&quot;6&quot;,5],[&quot;7&quot;,6],[&quot;8&quot;,7],[&quot;9&quot;,8],[&quot;0&quot;,9],[&quot;-&quot;,10],[&quot;=&quot;,11],[&quot;\\&quot;,12],[&quot;`&quot;,13]])o.set(&quot;&quot;+t,t=&gt;m.jr(t,r)),o.set(t+&quot;+x&quot;,t=&gt;m.ee(t,k.get(&quot;MARKX&quot;).X(r))),o.set(t+&quot;+y&quot;,t=&gt;m.ee(t,k.get(&quot;MARKY&quot;).X(r))),o.set(t+&quot;+z&quot;,t=&gt;m.ee(t,k.get(&quot;MARKZ&quot;).X(r)));function a(t,r,e=void 0){for(var i of t){if(o.has(i))throw new Error(&quot;Chord collision: &quot;+i);o.set(i,t=&gt;m.ee(t,k.get(r)))}void 0!==e&amp;&amp;a(t.map(t=&gt;&quot;shift+&quot;+t),e)}return o.set(&quot;p&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[1,0,0,.5])),o.set(&quot;alt+p&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[0,1,0,.5])),o.set(&quot;shift+p&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[0,0,1,.5])),o.set(&quot;p+x&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[1,0,0,.5])),o.set(&quot;p+y&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[0,1,0,.5])),o.set(&quot;p+z&quot;,t=&gt;m.ee(t,k.get(&quot;POL)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(YGON&quot;),[0,0,1,.5])),o.set(&quot;p+x+y&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[1,1,0,.5])),o.set(&quot;p+x+z&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[1,0,1,.5])),o.set(&quot;p+y+z&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[0,1,1,.5])),o.set(&quot;p+x+y+z&quot;,t=&gt;m.ee(t,k.get(&quot;POLYGON&quot;),[1,1,1,.5])),a([&quot;h&quot;,&quot;h+y&quot;,&quot;h+x+z&quot;],&quot;H&quot;,&quot;H&quot;),a([&quot;h+z&quot;,&quot;h+x+y&quot;],&quot;H_XY&quot;,&quot;H_XY&quot;),a([&quot;h+x&quot;,&quot;h+y+z&quot;],&quot;H_YZ&quot;,&quot;H_YZ&quot;),a([&quot;s+x&quot;,&quot;s+y+z&quot;],&quot;SQRT_X&quot;,&quot;SQRT_X_DAG&quot;),a([&quot;s+y&quot;,&quot;s+x+z&quot;],&quot;SQRT_Y&quot;,&quot;SQRT_Y_DAG&quot;),a([&quot;s&quot;,&quot;s+z&quot;,&quot;s+x+y&quot;],&quot;S&quot;,&quot;S_DAG&quot;),a([&quot;r+x&quot;,&quot;r+y+z&quot;],&quot;RX&quot;),a([&quot;r+y&quot;,&quot;r+x+z&quot;],&quot;RY&quot;),a([&quot;r&quot;,&quot;r+z&quot;,&quot;r+x+y&quot;],&quot;R&quot;),a([&quot;m+x&quot;,&quot;m+y+z&quot;],&quot;MX&quot;),a([&quot;m+y&quot;,&quot;m+x+z&quot;],&quot;MY&quot;),a([&quot;m&quot;,&quot;m+z&quot;,&quot;m+x+y&quot;],&quot;M&quot;),a([&quot;m+r+x&quot;,&quot;m+r+y+z&quot;],&quot;MRX&quot;),a([&quot;m+r+y&quot;,&quot;m+r+x+z&quot;],&quot;MRY&quot;),a([&quot;m+r&quot;,&quot;m+r+z&quot;,&quot;m+r+x+y&quot;],&quot;MR&quot;),a([&quot;c+x&quot;],&quot;CX&quot;,&quot;CX&quot;),a([&quot;c+y&quot;],&quot;CY&quot;,&quot;CY&quot;),a([&quot;c+z&quot;],&quot;CZ&quot;,&quot;CZ&quot;),a([&quot;c+x+y&quot;],&quot;XCY&quot;,&quot;XCY&quot;),a([&quot;alt+c+x&quot;],&quot;XCX&quot;,&quot;XCX&quot;),a([&quot;alt+c+y&quot;],&quot;YCY&quot;,&quot;YCY&quot;),a([&quot;w&quot;],&quot;SWAP&quot;,&quot;SWAP&quot;),a([&quot;w+x&quot;],&quot;CXSWAP&quot;,void 0),a([&quot;c+w+x&quot;],&quot;CXSWAP&quot;,void 0),a([&quot;i+w&quot;],&quot;ISWAP&quot;,&quot;ISWAP_DAG&quot;),a([&quot;f&quot;],&quot;C_XYZ&quot;,&quot;C_ZYX&quot;),a([&quot;c+s+x&quot;],&quot;SQRT_XX&quot;,&quot;SQRT_XX_DAG&quot;),a([&quot;c+s+y&quot;],&quot;SQR)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(T_YY&quot;,&quot;SQRT_YY_DAG&quot;),a([&quot;c+s+z&quot;],&quot;SQRT_ZZ&quot;,&quot;SQRT_ZZ_DAG&quot;),a([&quot;c+m+x&quot;],&quot;MXX&quot;,&quot;MXX&quot;),a([&quot;c+m+y&quot;],&quot;MYY&quot;,&quot;MYY&quot;),a([&quot;c+m+z&quot;],&quot;MZZ&quot;,&quot;MZZ&quot;),o}();function _t(r){m.Or.ft(r);var t=m.Or.nt;if(0!==t.length){for(var e=t[t.length-1];0&lt;t.length;)t.pop();var i=[...e.rt];if(0!==i.length){i.sort();let t=&quot;&quot;;e.altKey&amp;&amp;(t+=&quot;alt+&quot;),e.ctrlKey&amp;&amp;(t+=&quot;ctrl+&quot;),e.metaKey&amp;&amp;(t+=&quot;meta+&quot;),e.shiftKey&amp;&amp;(t+=&quot;shift+&quot;);for(var o of i)t+=o+&quot;+&quot;;t=t.substring(0,t.length-1);i=Ct.get(t);void 0!==i?(i(e.tt),r.preventDefault()):m.Ur(m.Pr())}}}document.addEventListener(&quot;keydown&quot;,_t),document.addEventListener(&quot;keyup&quot;,_t),m.canvas.width=m.canvas.scrollWidth,m.canvas.height=m.canvas.scrollHeight,m.rev.Dt().subscribe(()=&gt;{m.Tr.set(m.Kr(void 0));var t=m.Or.st(!1),e=(c.width=c.scrollWidth,c.height=c.scrollHeight,c.getContext(&quot;2d&quot;));e.clearRect(0,0,c.width,c.height),e.textAlign=&quot;right&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(&quot;X&quot;,7.5,24.5),e.fillText(&quot;Y&quot;,7.5,56.5),e.fillText(&quot;Z&quot;,7.5,88.5),e.textAlign=&quot;center&quot;,e.textBaseline=&quot;bottom&quot;;for(let t=0;t&lt;y.length;t++)e.fill)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(Text(y[t],24.5+32*t,R);e.fillStyle=&quot;white&quot;,e.strokeStyle=&quot;black&quot;;var i=[[&quot;H_YZ&quot;,&quot;S_X&quot;,&quot;R_X&quot;,&quot;M_X&quot;,&quot;C_X&quot;,&quot;X1&quot;,&quot;X2&quot;,&quot;X3&quot;,&quot;X4&quot;],[&quot;H&quot;,&quot;S_Y&quot;,&quot;R_Y&quot;,&quot;M_Y&quot;,&quot;C_Y&quot;,&quot;Y1&quot;,&quot;Y2&quot;,&quot;Y3&quot;,&quot;Y4&quot;],[&quot;H_XY&quot;,&quot;S&quot;,&quot;R&quot;,&quot;M&quot;,&quot;C_Z&quot;,&quot;Z1&quot;,&quot;Z2&quot;,&quot;Z3&quot;,&quot;Z4&quot;]];for(let r=0;r&lt;y.length;r++)for(let t=0;t&lt;3;t++)e.fillRect(R+32*r,R+32*t,28,28),e.strokeRect(R+32*r,R+32*t,28,28);e.fillStyle=&quot;black&quot;;for(let r=0;r&lt;y.length;r++)for(let t=0;t&lt;3;t++){var o,a,n=i[t][r],s=R+32*r+14,l=R+32*t+14;-1!==n.indexOf(&quot;_&quot;)?([o,a]=n.split(&quot;_&quot;),e.font=&quot;16pt monospace&quot;,e.textAlign=&quot;right&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(o,s,l),e.font=1===a.length?&quot;12pt monospace&quot;:&quot;8pt monospace&quot;,e.textAlign=&quot;left&quot;,e.textBaseline=&quot;top&quot;,e.fillText(a,s,l)):(e.font=&quot;16pt monospace&quot;,e.textAlign=&quot;center&quot;,e.textBaseline=&quot;middle&quot;,e.fillText(n,s,l))}performance.now(),void 0!==(t=ut(t)).Cr&amp;&amp;(e.fillStyle=&quot;rgba(255, 255, 0, &quot;+.5*t.Cr.strength+&quot;)&quot;,e.fillRect(0,R+32*t.Cr.Ar-2,R+32*y.length,32)),void 0!==t.gr&amp;&amp;(e.fillStyle=&quot;rgba(255, 255, 0, &quot;+.5*t.gr.strength+&quot;)&quot;,e.fillRect(R+32*t.gr.Er-2,0,32,106.5)))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,void 0!==t._r&amp;&amp;void 0!==t.gr&amp;&amp;(e.fillStyle=&quot;rgba(255, 0, 0, 0.5)&quot;,e.fillRect(R+32*t.gr.Er-2,R+32*t._r.Ar-2,32,32)),e.textAlign=&quot;left&quot;,e.textBaseline=&quot;middle&quot;,e.fillStyle=&quot;black&quot;,e.fillText(&quot;W=SWAP&quot;,R+32*y.length,R),e.fillText(&quot;F=C_XYZ&quot;,R+32*y.length,30.5),e.fillText(&quot;P=POLYGON&quot;,R+32*y.length,50.5),e.fillText(&quot;space=unmark&quot;,R+32*y.length,70.5),e.fillText(&quot;I=ISWAP&quot;,R+32*y.length,90.5),e.fillText(&quot;L=TIMELINEFOCUS&quot;,R+32*y.length,110.5)});{var gt=m.rev;const p=new ct;t=()=&gt;{p.yr();try{var t,r=(()=&gt;{var t=document.location.hash.substring(1),r=new Map;if(&quot;&quot;!==t)for(var e of t.split(&quot;&amp;&quot;)){var i,o=e.indexOf(&quot;=&quot;);-1!==o&amp;&amp;(i=e.substring(0,o),e=decodeURIComponent(e.substring(o+1)),r.set(i,e))}return r})(),e=(r.has(&quot;circuit&quot;)||(&quot;[[[DEFAULT-CIRCUIT-CONTENT-LITERAL]]]&quot;===(t=document.getElementById(&quot;txtDefaultCircuit&quot;)).value.replaceAll(&quot;_&quot;,&quot;-&quot;)?r.set(&quot;circuit&quot;,&quot;&quot;):r.set(&quot;circuit&quot;,t.value)),p.Ir(r.get(&quot;circuit&quot;)),u.D(r.get(&quot;circuit&quot;))),i=e.W();gt.clear(i),e.G.every(t=&gt;t.O())&amp;&amp;1===r.size&amp;&amp;i===r.get(&quot;circuit&quot;)?p.mr():p.pr(i,v)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(t(i))}catch(t){throw new Error(t)}},window.addEventListener(&quot;popstate&quot;,t),t(),gt.Qt().gt()._t(1).subscribe(t=&gt;{p.pr(t,vt(t))})}m.Tr.Tt().subscribe(t=&gt;requestAnimationFrame(()=&gt;ot(m.canvas.getContext(&quot;2d&quot;),t))),window.addEventListener(&quot;focus&quot;,()=&gt;{m.Or.ht()}),window.addEventListener(&quot;blur&quot;,()=&gt;{m.Or.ht()});
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(&lt;/script&gt;
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART("></iframe>)CRUMBLE_PART");
    return result;
}
